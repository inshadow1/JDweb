<!doctype html><html lang=zh-CN dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-JavaScript & TypeScript/4.4-数据通信" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>4.4-数据通信 | Yelv的笔记本</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content="https://yelv.site/docs/JavaScript & TypeScript/4.4-数据通信"><meta data-rh=true property=og:locale content=zh_CN><meta data-rh=true name=docusaurus_locale content=zh-CN><meta data-rh=true name=docsearch:language content=zh-CN><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="4.4-数据通信 | Yelv的笔记本"><meta data-rh=true name=description content="Create by fall on 2021-09-22"><meta data-rh=true property=og:description content="Create by fall on 2021-09-22"><link data-rh=true rel=icon href=/./svg/fallen_leaf.svg><link data-rh=true rel=canonical href="https://yelv.site/docs/JavaScript & TypeScript/4.4-数据通信"><link data-rh=true rel=alternate href="https://yelv.site/docs/JavaScript & TypeScript/4.4-数据通信" hreflang=zh-CN><link data-rh=true rel=alternate href="https://yelv.site/docs/JavaScript & TypeScript/4.4-数据通信" hreflang=x-default><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Yelv的笔记本 RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Yelv的笔记本 Atom Feed"><link rel=stylesheet href=/assets/css/styles.c2e4bc48.css><script src=/assets/js/runtime~main.0e1e3ec5.js defer></script><script src=/assets/js/main.a9a7f46f.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label=跳到主要内容><a class=skipToContent_evv2 href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="navbar navbar--fixed-top navbarHideable_DR3r"><div class=navbar__inner><div class=navbar__items><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/./svg/boy_avatar.svg alt="My Site Logo" class="themedComponent_jGkr themedComponent--light_q8xF"><img src=/./svg/boy_avatar.svg alt="My Site Logo" class="themedComponent_jGkr themedComponent--dark_QPgF"></div><b class="navbar__title text--truncate">Yelv 的笔记本</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs/前端环境搭建>笔记</a><a class="navbar__item navbar__link" href=/blog>Blog</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/inshadow1 target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_yvLq><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_BNzi colorModeToggle_GX4g"><button class="clean-btn toggleButton_RykJ toggleButtonDisabled_Ej6G" type=button disabled title=切换浅色/暗黑模式（当前为浅色模式） aria-label=切换浅色/暗黑模式（当前为浅色模式） aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_YzKc><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_gN9v><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Orp6></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_Aqwn"><div class=docsWrapper_yuk7><button aria-label=回到顶部 class="clean-btn theme-back-to-top-button backToTopButton_HTPM" type=button></button><div class=docRoot_geNn><aside class="theme-doc-sidebar-container docSidebarContainer_EH_S"><div class=sidebarViewport_X601><div class="sidebar_exRw sidebarWithHideableNavbar_nuZN"><a tabindex=-1 class=sidebarLogo_RnwF href=/><img src=/./svg/boy_avatar.svg alt="My Site Logo" class="themedComponent_jGkr themedComponent--light_q8xF"><img src=/./svg/boy_avatar.svg alt="My Site Logo" class="themedComponent_jGkr themedComponent--dark_QPgF"><b>Yelv 的笔记本</b></a><nav aria-label=文档侧边栏 class="menu thin-scrollbar menu_Xttl"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/html-和-css>HTML 和 CSS</a><button aria-label="展开侧边栏分类 'HTML 和 CSS'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/docs/category/javascript--typescript>JavaScript & TypeScript</a><button aria-label="折叠侧边栏分类 'JavaScript & TypeScript'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" tabindex=0 href=/docs/category/typescript>TypeScript</a><button aria-label="展开侧边栏分类 'TypeScript'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/1.1-JS基础知识">1.1-JS基础知识</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/1.2-变量与类型">1.2-变量与类型</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/1.3-运算符">1.3-运算符</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/1.4-构造类型">1.4-构造类型</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/1.5-扩展数据类型">1.5-扩展数据类型</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/1.6-正则">1.6-正则</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/1.7-工具对象">1.7-工具对象</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/2.1-this 和函数">2.1-this 和函数</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/2.2-面向对象编程">2.2-面向对象编程</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/2.3-模块化开发">2.3-模块化开发</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/2.4-错误捕获及兼容">2.4-错误捕获及兼容</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/3.1-DOM和事件">3.1-DOM和事件</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/3.2-DOM 相关 API">3.2-DOM 相关 API</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/3.3-WebComponent">3.3-WebComponent</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/3.4-canvas">3.4-canvas</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/3.5-浏览器对象">3.5-浏览器对象</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/3.6-浏览器的存储">3.6-浏览器的存储</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/3.7-跨窗口交互">3.7-跨窗口交互</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/4.1-前后端交互">4.1-前后端交互</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/4.2-Promise 和 async">4.2-Promise 和 async</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/4.3-迭代器">4.3-迭代器</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href="/docs/JavaScript & TypeScript/4.4-数据通信">4.4-数据通信</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/4.5-二进制对象">4.5-二进制对象</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/5.1-多线程">5.1-多线程</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href="/docs/JavaScript & TypeScript/6-WebAssembly">6-WebAssembly</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href="/docs/JavaScript & TypeScript/JS 常用方法/-- JS字符串处理">JS 常用方法</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false tabindex=0 href="/docs/JavaScript & TypeScript/高级程序设计/-- JS设计模式">高级程序设计</a></div></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/大前端知识点>大前端知识点</a><button aria-label="展开侧边栏分类 '大前端知识点'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/npm-包>npm 包</a><button aria-label="展开侧边栏分类 'npm 包'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/vue>Vue</a><button aria-label="展开侧边栏分类 'Vue'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/react>React</a><button aria-label="展开侧边栏分类 'React'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/后端>后端</a><button aria-label="展开侧边栏分类 '后端'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/linux--命令行>Linux & 命令行</a><button aria-label="展开侧边栏分类 'Linux & 命令行'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/数据库>数据库</a><button aria-label="展开侧边栏分类 '数据库'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/多平台开发>多平台开发</a><button aria-label="展开侧边栏分类 '多平台开发'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/其它语言>其它语言</a><button aria-label="展开侧边栏分类 '其它语言'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/软件工程知识>软件工程知识</a><button aria-label="展开侧边栏分类 '软件工程知识'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/人工智能>人工智能</a><button aria-label="展开侧边栏分类 '人工智能'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs/category/面试-自检>面试-自检</a><button aria-label="展开侧边栏分类 '面试-自检'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/git工具>git工具</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href="/docs/npm 和 nvm 的使用">npm 和 nvm 的使用</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/前端环境搭建>前端环境搭建</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs/学习资料>学习资料</a></ul></nav></div></div></aside><main class=docMainContainer_chaf><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_MbFo"><div class=docItemContainer_k35T><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Bj4H" aria-label=页面路径><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label=主页面 class=breadcrumbs__link href=/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_iLtS><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs/category/javascript--typescript><span itemprop=name>JavaScript & TypeScript</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>4.4-数据通信</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_sD45 theme-doc-toc-mobile tocMobile_xywk"><button type=button class="clean-btn tocCollapsibleButton_vIkA">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>4.4-数据通信</h1></header><blockquote>
<p>Create by <strong>fall</strong> on 2021-09-22
Recently revised in 2022-01-27</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=文件处理>文件处理<a href=#文件处�理 class=hash-link aria-label=文件处理的直接链接 title=文件处理的直接链接>​</a></h2>
<p>前端的文件处理包括，上传，类型检查，文件类型转换，二进制处理，文件下载</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=上传文件>上传文件<a href=#上传文件 class=hash-link aria-label=上传文件的直接链接 title=上传文件的直接链接>​</a></h2>
<p>场景：单文件、多文件、目录上传、压缩目录上传、拖拽上传、剪贴板上传、大文件分块上传、服务端上传。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=单文件上传>单文件上传<a href=#单文件上传 class=hash-link aria-label=单文件上传的直接链接 title=单文件上传的直接链接>​</a></h3>
<p><strong>前端代码</strong></p>
<div class="language-html codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-html codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>input</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>'</span><span class="token tag attr-value" style=color:#e3116c>uploadFile</span><span class="token tag attr-value punctuation" style=color:#393A34>'</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>type</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>file</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>accept</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag attr-value" style=color:#e3116c>image/*</span><span class="token tag attr-value punctuation" style=color:#393A34>"</span><span class="token tag punctuation" style=color:#393A34>/></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token tag punctuation" style=color:#393A34>&lt;</span><span class="token tag" style=color:#00009f>button</span><span class="token tag" style=color:#00009f> </span><span class="token tag attr-name" style=color:#00a4db>id</span><span class="token tag attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag attr-value punctuation" style=color:#393A34>'</span><span class="token tag attr-value" style=color:#e3116c>submit</span><span class="token tag attr-value punctuation" style=color:#393A34>'</span><span class="token tag" style=color:#00009f> </span><span class="token tag special-attr attr-name" style=color:#00a4db>onclick</span><span class="token tag special-attr attr-value punctuation attr-equals" style=color:#393A34>=</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>'</span><span class="token tag special-attr attr-value value javascript language-javascript function" style=color:#d73a49>uploadFile</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style=color:#393A34>(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style=color:#393A34>)</span><span class="token tag special-attr attr-value punctuation" style=color:#393A34>'</span><span class="token tag punctuation" style=color:#393A34>></span><span class="token plain">上传文件</span><span class="token tag punctuation" style=color:#393A34>&lt;/</span><span class="token tag" style=color:#00009f>button</span><span class="token tag punctuation" style=color:#393A34>></span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>其中 accept 用于限制上传文件类型。IE9 以下不支持该属性（IE 已死）</p>
<ul>
<li><code>image/*</code> 限制只能上传 image 文件</li>
<li><code>image/png</code> 限制只能上传png</li>
<li><code>image/png,image/jpeg</code> 限制只能上传png和jpg</li>
</ul>
<blockquote>
<p>accept只进行限制后缀名，把后缀名更改还是可以绕过检测，而想实现只接受特定的格式，使用其他工具，或者是看这个教程 <a href=https://juejin.cn/post/6971935704938971173 target=_blank rel="noopener noreferrer">如何区分图片类型</a>。</p>
</blockquote>
<p><strong>JS代码</strong></p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> uploadFileEle </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token dom variable" style=color:#36acaa>document</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>querySelector</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'#uploadFile'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> request </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> axios</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>create</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token literal-property property" style=color:#36acaa>baseURL</span><span class="token operator" style=color:#393A34>:</span><span class="token string" style=color:#e3116c>'http://localhost:8080/upload'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token literal-property property" style=color:#36acaa>timeout</span><span class="token operator" style=color:#393A34>:</span><span class="token number" style=color:#36acaa>60000</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 判断是否存在文件，获取文件，进行上传</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> functioin </span><span class="token function" style=color:#d73a49>uploadFile</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token plain">uploadFileEle</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">files</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> file </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> uploadFileEle</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">files</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>upload</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>url</span><span class="token operator" style=color:#393A34>:</span><span class="token string" style=color:#e3116c>'/single'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    file</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>upload</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">url</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">file</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">fieldName</span><span class="token operator" style=color:#393A34>=</span><span class="token string" style=color:#e3116c>'file'</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> formData </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  formData</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>set</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">fieldName</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">file</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  request</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>post</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">url</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">formData</span><span class="token punctuation" style=color:#393A34>,</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function-variable function" style=color:#d73a49>onPuloadProgress</span><span class="token operator" style=color:#393A34>:</span><span class="token keyword" style=color:#00009f>function</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">progressEvent</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> percentCompleted </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>round</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">progressEvent</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">loaded</span><span class="token operator" style=color:#393A34>*</span><span class="token number" style=color:#36acaa>100</span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>/</span><span class="token plain">progressEvent</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">total</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>log</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">percentCompleted</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>上述代码先把读取的 File 对象封装成FormData对象，然后利用 Axios 的 post 实现文件上传的功能。再上传之前，通过请求配置对象的onUploadProgress 就可以获取文件的上传进度。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=大文件上传>大文件上传<a href=#大文件上传 class=hash-link aria-label=大文件上传的直接链接 title=大文件上传的直接链接>​</a></h3>
<p>​	现在来看看在上面提到的几种上传方式中实现大文件上传会遇见的超时问题，</p>
<ul>
<li>表单上传和iframe无刷新页面上传，实际上都是通过form标签进行上传文件，这种方式将整个请求完全交给浏览器处理，当上传大文件时，可能会遇见请求超时的情形</li>
<li>通过fromData，其实际也是在xhr中封装一组请求参数，用来模拟表单请求，无法避免大文件上传超时的问题</li>
<li>编码上传，我们可以比较灵活地控制上传的内容</li>
</ul>
<p>​	大文件上传最主要的问题就在于：<strong>在同一个请求中，要上传大量的数据，导致整个过程会比较漫长，且失败后需要重头开始上传</strong>。试想，如果我们将这个请求拆分成多个请求，每个请求的时间就会缩短，且如果某个请求失败，只需要重新发送这一次请求即可，无需从头开始，这样是否可以解决大文件上传的问题呢？</p>
<p>​	综合上面的问题，看来大文件上传需要实现下面几个需求</p>
<ul>
<li>​		支持拆分上传请求(即切片)</li>
<li>​		支持断点续传</li>
<li>​		支持显示上传进度和暂停上传</li>
</ul>
<p>​	接下来让我们依次实现这些功能，看起来最主要的功能应该就是切片了。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=文件切片><strong>文件切片</strong><a href=#文件切片 class=hash-link aria-label=文件切片的直接链接 title=文件切片的直接链接>​</a></h3>
<p>​	编码方式上传中，在前端我们只要先获取文件的二进制内容，然后对其内容进行拆分，最后将每个切片上传到服务端即可。</p>
<p>​	在JavaScript中，文件FIle对象是Blob对象的子类，Blob对象包含一个重要的方法slice，通过这个方法，我们就可以对二进制文件进行拆分。</p>
<p>​	下面是一个拆分文件的示例</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>slice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">file</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> piece </span><span class="token parameter operator" style=color:#393A34>=</span><span class="token parameter"> </span><span class="token parameter number" style=color:#36acaa>1024</span><span class="token parameter"> </span><span class="token parameter operator" style=color:#393A34>*</span><span class="token parameter"> </span><span class="token parameter number" style=color:#36acaa>1024</span><span class="token parameter"> </span><span class="token parameter operator" style=color:#393A34>*</span><span class="token parameter"> </span><span class="token parameter number" style=color:#36acaa>5</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> totalSize </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">size</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 文件总大小</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> start </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 每次上传的开始字节</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> end </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> start </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> piece</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 每次上传的结尾字节</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> chunks </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>while</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">start </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> totalSize</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 根据长度截取每次需要上传的数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// File对象继承自Blob对象，因此包含slice方法</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> blob </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>slice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">start</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> end</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><br></span><span class=token-line style=color:#393A34><span class="token plain"> chunks</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">blob</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> start </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> end</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> end </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> start </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> piece</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> chunks</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	将文件拆分成piece大小的分块，然后每次请求只需要上传这一个部分的分块即可</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> file </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token dom variable" style=color:#36acaa>document</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>querySelector</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"[name=file]"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">files</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>LENGTH</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1024</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1024</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.1</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> chunks </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>slice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">file</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>LENGTH</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 首先拆分切片</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">chunks</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>forEach</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">chunk</span><span class="token arrow operator" style=color:#393A34>=></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> fd </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"file"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> chunk</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token function" style=color:#d73a49>post</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'/mkblk.php'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	服务器接收到这些切片后，再将他们拼接起来就可以了，下面是PHP拼接切片的示例代码</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token plain">$filename </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'./upload/'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain"> </span><span class="token property-access">$_POST</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'filename'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token comment" style=color:#999988;font-style:italic>//确定上传的文件名</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>//第一次上传时没有文件，就创建文件，此后上传只需要把数据追加到此文件中</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token function" style=color:#d73a49>file_exists</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$filename</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token function" style=color:#d73a49>move_uploaded_file</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$_FILES</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'file'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'tmp_name'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">$filename</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token keyword control-flow" style=color:#00009f>else</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token function" style=color:#d73a49>file_put_contents</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$filename</span><span class="token punctuation" style=color:#393A34>,</span><span class="token function" style=color:#d73a49>file_get_contents</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$_FILES</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'file'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'tmp_name'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token constant" style=color:#36acaa>FILE_APPEND</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> echo $filename</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	测试时记得修改nginx的server配置，否则大文件可能会提示413 Request Entity Too Large的错误。</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token plain">server </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    client_max_body_size 50m</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	上面这种方式来存在一些问题</p>
<ul>
<li>​		无法识别一个切片是属于哪一个切片的，当同时发生多个请求时，追加的文件内容会出错</li>
<li>​		切片上传接口是异步的，无法保证服务器接收到的切片是按照请求顺序拼接的</li>
</ul>
<p>​	因此接下来我们来看看应该如何在服务端还原切片。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=还原切片><strong>还原切片</strong><a href=#还原切片 class=hash-link aria-label=还原切片的直接链接 title=还原切片的直接链接>​</a></h3>
<p>​	在后端需要将多个相同文件的切片还原成一个文件，上面这种处理切片的做法存在下面几个问题</p>
<ul>
<li>​		如何识别多个切片是来自于同一个文件的，这个可以在每个切片请求上传递一个相同文件的context参数</li>
<li>​		如何将多个切片还原成一个文件</li>
<li>​		确认所有切片都已上传，这个可以通过客户端在切片全部上传后调用mkfile接口来通知服务端进行拼接</li>
<li>​		找到同一个context下的所有切片，确认每个切片的顺序，这个可以在每个切片上标记一个位置索引值</li>
<li>​		按顺序拼接切片，还原成文件</li>
</ul>
<p>​	上面有一个重要的参数，即context，我们需要获取为一个文件的唯一标识，可以通过下面两种方式获取</p>
<ul>
<li>​		根据文件名、文件长度等基本信息进行拼接，为了避免多个用户上传相同的文件，可以再额外拼接用户信息如uid等保证唯一性</li>
<li>​		根据文件的二进制内容计算文件的hash，这样只要文件内容不一样，则标识也会不一样，缺点在于计算量比较大.</li>
</ul>
<p>​	修改上传代码，增加相关参数</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// 获取context，同一个文件会返回相同的值</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>createContext</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">file</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">     </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> file </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token dom variable" style=color:#36acaa>document</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>querySelector</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"[name=file]"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">files</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>LENGTH</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1024</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1024</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0.1</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> chunks </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>slice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">file</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>LENGTH</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 获取对于同一个文件，获取其的context</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> context </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>createContext</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">file</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> tasks </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">chunks</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>forEach</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">chunk</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> index</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> fd </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"file"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> chunk</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 传递context</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"context"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 传递切片索引值</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"chunk"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> index </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> tasks</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>post</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"/mkblk.php"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 所有切片上传完毕后，调用mkfile接口</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>all</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">tasks</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>then</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">res</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> fd </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"context"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"chunks"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> chunks</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token function" style=color:#d73a49>post</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"/mkfile.php"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>then</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">res</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>log</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">res</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	在mkblk.php接口中，我们通过context来保存同一个文件相关的切片</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// mkblk.php</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">$context </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> $_POST</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'context'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">$path </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'./upload/'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain"> </span><span class="token property-access">$context</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token function" style=color:#d73a49>is_dir</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$path</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token function" style=color:#d73a49>mkdir</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$path</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 把同一个文件的切片放在相同的目录下</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">$filename </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> $path </span><span class="token punctuation" style=color:#393A34>.</span><span class="token string" style=color:#e3116c>'/'</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain"> </span><span class="token property-access">$_POST</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'chunk'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">$res </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>move_uploaded_file</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$_FILES</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'file'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'tmp_name'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">$filename</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	除了上面这种简单通过目录区分切片的方法之外，还可以将切片信息保存在数据库来进行索引。接下来是mkfile.php接口的实现，这个接口会在所有切片上传后调用</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// mkfile.php</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">$context </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> $_POST</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'context'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">$chunks </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">int</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain">$_POST</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'chunks'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>//合并后的文件名</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">$filename </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'./upload/'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain"> </span><span class="token property-access">$context</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'/file.jpg'</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword control-flow" style=color:#00009f>for</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$i </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> $i </span><span class="token operator" style=color:#393A34>&lt;=</span><span class="token plain"> $chunks</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>++</span><span class="token plain">$i</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> $file </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'./upload/'</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">$context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'/'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">$i</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 读取单个切块</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> $content </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>file_get_contents</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$file</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token function" style=color:#d73a49>file_exists</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$filename</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> $fd </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>fopen</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$filename</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"w+"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token keyword control-flow" style=color:#00009f>else</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> $fd </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>fopen</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$filename</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"a"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token function" style=color:#d73a49>fwrite</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">$fd</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> $content</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 将切块合并到一个文件上</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">echo $filename</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	这样就解决了上面的两个问题：</p>
<ul>
<li>​		识别切片来源</li>
<li>​		保证切片拼接顺序</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=断点续传><strong>断点续传</strong><a href=#断点续传 class=hash-link aria-label=断点续传的直接链接 title=断点续传的直接链接>​</a></h3>
<p>​	即使将大文件拆分成切片上传，我们仍需等待所有切片上传完毕，在等待过程中，可能发生一系列导致部分切片上传失败的情形，如网络故障、页面关闭等。由于切片未全部上传，因此无法通知服务端合成文件。这种情况下可以通过<strong>断点续传</strong>来进行处理。</p>
<p>​	断点续传指的是：可以从已经上传部分开始继续上传未完成的部分，而没有必要从头开始上传，节省上传时间。</p>
<p>​	由于整个上传过程是按切片维度进行的，且mkfile接口是在所有切片上传完成后由客户端主动调用的，因此断点续传的实现也十分简单：</p>
<ul>
<li>​		在切片上传成功后，保存已上传的切片信息</li>
<li>​		当下次传输相同文件时，遍历切片列表，只选择未上传的切片进行上传</li>
<li>​		所有切片上传完毕后，再调用mkfile接口通知服务端进行文件合并</li>
</ul>
<p>​	因此问题就落在了如何保存已上传切片的信息了，保存一般有两种策略</p>
<ul>
<li>​		可以通过locaStorage等方式保存在前端浏览器中，这种方式不依赖于服务端，实现起来也比较方便，缺点在于如果用户清除了本地文件，会导致上传记录丢失</li>
<li>​		服务端本身知道哪些切片已经上传，因此可以由服务端额外提供一个根据文件context查询已上传切片的接口，在上传文件前调用该文件的历史上传记录</li>
</ul>
<p>​	下面让我们通过在本地保存已上传切片记录，来实现断点上传的功能</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// 获取已上传切片记录</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUploadSliceRecord</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> record </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token dom variable" style=color:#36acaa>localStorage</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>getItem</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token punctuation" style=color:#393A34>(</span><span class="token operator" style=color:#393A34>!</span><span class="token plain">record</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token keyword control-flow" style=color:#00009f>else</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>try</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>parse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">record</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token keyword control-flow" style=color:#00009f>catch</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">e</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 保存已上传切片</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>saveUploadSliceRecord</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">context</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> sliceIndex</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> list </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUploadSliceRecord</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> list</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">sliceIndex</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token dom variable" style=color:#36acaa>localStorage</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>setItem</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>stringify</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">list</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	然后对上传逻辑稍作修改，主要是增加上传前检测是已经上传、上传后保存记录的逻辑</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> context </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>createContext</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">file</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 获取上传记录</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> record </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>getUploadSliceRecord</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> tasks </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">chunks</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>forEach</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">chunk</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> index</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 已上传的切片则不再重新上传</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">record</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>includes</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> fd </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"file"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> chunk</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"context"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> context</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"chunk"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> index </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> task </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>post</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"/mkblk.php"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> fd</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>then</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">res</span><span class="token arrow operator" style=color:#393A34>=></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 上传成功后保存已上传切片记录</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token function" style=color:#d73a49>saveUploadSliceRecord</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> index</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> record</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">index</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"> tasks</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">task</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>​	此时上传时刷新页面或者关闭浏览器，再次上传相同文件时，之前已经上传成功的切片就不会再重新上传了。</p>
<p>​	服务端实现断点续传的逻辑基本相似，只要在getUploadSliceRecord内部调用服务端的查询接口获取已上传切片的记录即可，因此这里不再展开。</p>
<p>​	此外断点续传还需要考虑<strong>切片过期</strong>的情况：如果调用了mkfile接口，则磁盘上的切片内容就可以清除掉了，如果客户端一直不调用mkfile的接口，放任这些切片一直保存在磁盘显然是不可靠的，一般情况下，切片上传都有一段时间的有效期，超过该有效期，就会被清除掉。基于上述原因，断点续传也必须同步切片过期的实现逻辑。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=上传进度和暂停><strong>上传进度和暂停</strong><a href=#上传进度和暂停 class=hash-link aria-label=上传进度和暂停的直接链接 title=上传进度和暂停的直接链接>​</a></h3>
<p>​	通过xhr.upload中的progress方法可以实现监控每一个切片上传进度。</p>
<p>​	上传暂停的实现也比较简单，通过xhr.abort可以取消当前未完成上传切片的上传，实现上传暂停的效果，恢复上传就跟断点续传类似，先获取已上传的切片列表，然后重新发送未上传的切片。</p>
<p>​	由于篇幅关系，上传进度和暂停的功能这里就先不实现了。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=应用场景>应用场景<a href=#应用场景 class=hash-link aria-label=应用场景的直接链接 title=应用场景的直接链接>​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=保存文件>保存文件<a href=#保存文件 class=hash-link aria-label=保存文件的直接链接 title=保存文件的直接链接>​</a></h3>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>onSaveFile</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> blob </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Blob</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">codeContext</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">value</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#36acaa>type</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'text/javascript'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> url </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>URL</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>createObjectURL</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">blob</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> a </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token dom variable" style=color:#36acaa>document</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>createElement</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>"a"</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  a</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">download</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"sunshine"</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  a</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">href</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> url</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token dom variable" style=color:#36acaa>document</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">body</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>appendChild</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">a</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  a</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>click</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token dom variable" style=color:#36acaa>document</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">body</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>removeChild</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">a</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=分片上传>分片上传<a href=#分片上传 class=hash-link aria-label=分片上传的直接链接 title=分片上传的直接链接>​</a></h3>
<p>分片上传：对于大文件的上传，通过 slice 的方法对大文件进行切割，然后分片进行上传</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> file </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'a'</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>repeat</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>1000000</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token string" style=color:#e3116c>'test.txt'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> chunkSize </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>40000</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> postUrl </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'https://example.web/post'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>chunkUpload</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>for</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> start </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain">start</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">size</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain">start</span><span class="token operator" style=color:#393A34>+=</span><span class="token plain">chunkSize</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> chunk </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>slice</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">start</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">start</span><span class="token operator" style=color:#393A34>+</span><span class="token plain">chunkSize</span><span class="token operator" style=color:#393A34>+</span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> fd </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FormData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    fd</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>append</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'data'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">chunk</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>fetch</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">postUrl</span><span class="token punctuation" style=color:#393A34>,</span><span class="token punctuation" style=color:#393A34>{</span><span class="token literal-property property" style=color:#36acaa>method</span><span class="token operator" style=color:#393A34>:</span><span class="token string" style=color:#e3116c>'post'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token literal-property property" style=color:#36acaa>body</span><span class="token operator" style=color:#393A34>:</span><span class="token plain">fd</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>then</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">res</span><span class="token arrow operator" style=color:#393A34>=></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      res</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>text</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=下载数据>下载数据<a href=#下载数据 class=hash-link aria-label=下载数据的直接链接 title=下载数据的直接链接>​</a></h3>
<p>下载数据：可以将从互联网上下载的数据存放到 Blob 对象中</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// 使用 XMLHttpRequest</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>downloadBlob</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">url</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter">callback</span><span class="token punctuation" style=color:#393A34>)</span><span class="token arrow operator" style=color:#393A34>=></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> xhr </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">XMLHttpRequest</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  xhr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>open</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'GET'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain">url</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  xhr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">responseType</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'blob'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  xhr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method-variable function-variable method function property-access" style=color:#d73a49>onload</span><span class="token operator" style=color:#393A34>=</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token arrow operator" style=color:#393A34>=></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>callback</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">xhr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">response</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  xhr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>send</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 使用 fetch</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> myImg </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token dom variable" style=color:#36acaa>document</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>querySelector</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'img'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> myReq </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Request</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'flowers.jpg'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>fetch</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">myReq</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>then</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">res</span><span class="token arrow operator" style=color:#393A34>=></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> response</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>blob</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>then</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">blob</span><span class="token arrow operator" style=color:#393A34>=></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> objURL </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>URL</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>createObjectURL</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">blob</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  myImage</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> objURL</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=导出为-excel>导出为 Excel<a href=#导出为-excel class=hash-link aria-label="导出为 Excel的直接链接" title="导出为 Excel的直接链接">​</a></h3>
<p>导入文件：</p>
<ul>
<li>用户上传文件，前端 FileReader 读取文件为二进制字符串</li>
<li>解析二进制字符串为 excel 工作簿对象</li>
<li>XLSX.utils.sheet_to_json()方法，从工作簿对象中获取第一张 Sheets 表格数据并将其转换为 json 数据。</li>
</ul>
<p>导出文件：</p>
<ul>
<li>XLSX.utils.book_new() 创建工作簿对象</li>
<li></li>
</ul>
<p>需要用到 xlsx 插件</p>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword module" style=color:#00009f>import</span><span class="token plain"> </span><span class="token imports">xlsx</span><span class="token plain"> </span><span class="token keyword module" style=color:#00009f>from</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'xlsx'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword module" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> </span><span class="token function-variable function" style=color:#d73a49>exportJsonToExcel</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter punctuation" style=color:#393A34>{</span><span class="token parameter"></span><br></span><span class=token-line style=color:#393A34><span class="token parameter">  header</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"></span><br></span><span class=token-line style=color:#393A34><span class="token parameter">  data</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"></span><br></span><span class=token-line style=color:#393A34><span class="token parameter">  key</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"></span><br></span><span class=token-line style=color:#393A34><span class="token parameter">  title</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"></span><br></span><span class=token-line style=color:#393A34><span class="token parameter">  filename</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"></span><br></span><span class=token-line style=color:#393A34><span class="token parameter">  autoWidth</span><br></span><span class=token-line style=color:#393A34><span class="token parameter"></span><span class="token parameter punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> wb </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>XLSX</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">utils</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>book_new</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">header</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    data</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>unshift</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">header</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">title</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    data</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>unshift</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">title</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> ws </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>XLSX</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">utils</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>json_to_sheet</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">data</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>header</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> key</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token literal-property property" style=color:#36acaa>skipHeader</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>true</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">autoWidth</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> arr </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>json_to_array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">key</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> data</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>auto_width</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">ws</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> arr</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  xlsx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">utils</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>book_append_sheet</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">wb</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> ws</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> filename</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  xlsx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>writeFile</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">wb</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> filename </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'.xlsx'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_B8AY theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_hioy><pre tabindex=0 class="prism-code language-js codeBlock_JYkK thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_EaH7><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>importExcel</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">file</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> tableTemplate</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> reject</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> f </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> file</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">raw</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 获取文件内容</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// 通过DOM取文件数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> rABS </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 是否将文件读取为二进制字符串</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> reader </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FileReader</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token class-name">FileReader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">prototype</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method-variable function-variable method function property-access" style=color:#d73a49>readAsBinaryString</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">f</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> binary </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>''</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> rABS </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>false</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 是否将文件读取为二进制字符串</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> wb </span><span class="token comment" style=color:#999988;font-style:italic>// 读取完成的数据</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> outdata</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> reader </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">FileReader</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      reader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method-variable function-variable method function property-access" style=color:#d73a49>onload</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">e</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> bytes </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Uint8Array</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">reader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">result</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> length </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> bytes</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">byteLength</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword control-flow" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> length</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          binary </span><span class="token operator" style=color:#393A34>+=</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>fromCharCode</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">bytes</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">i</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>XLSX</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>require</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'xlsx'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">rABS</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          wb </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>XLSX</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>read</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>btoa</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">binary</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// 手动转化</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token literal-property property" style=color:#36acaa>type</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'base64'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>else</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          wb </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>XLSX</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>read</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">binary</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token literal-property property" style=color:#36acaa>type</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'binary'</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        outdata </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>XLSX</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">utils</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>sheet_to_json</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">wb</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">Sheets</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">wb</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access maybe-class-name">SheetNames</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// outdata就是表格中的值</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> arr </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token comment" style=color:#999988;font-style:italic>// 下面是数据解析提取逻辑</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">tableTemplate</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>></span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> tempArr </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>keys</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">outdata</span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> tempArrNew </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token keyword control-flow" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> i </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> tempArr</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword control-flow" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> k </span><span class="token keyword" style=color:#00009f>in</span><span class="token plain"> tableTemplate</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">i </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> k</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">                tempArrNew</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token literal-property property" style=color:#36acaa>fieldE</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> tableTemplate</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">k</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token literal-property property" style=color:#36acaa>fieldC</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> tempArr</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">i</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">              </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          tempArr </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> tempArrNew</span><br></span><span class=token-line style=color:#393A34><span class="token plain">          outdata</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>map</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> obj </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            tempArr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>map</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">temp2</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">              obj</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">temp2</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">fieldE</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> item</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">temp2</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">fieldC</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">            arr</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">obj</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token function" style=color:#d73a49>resolve</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">arr</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      reader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>readAsArrayBuffer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">f</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">rABS</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      reader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>readAsArrayBuffer</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">f</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>else</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      reader</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>readAsBinaryString</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">f</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre><div class=buttonGroup_OtWR><button type=button aria-label=复制代码到剪贴板 title=复制 class=clean-btn><span class=copyButtonIcons_e_Uv aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_axPd><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_ydrQ><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_ZPNM" id=参考文章>参考文章<a href=#参考文章 class=hash-link aria-label=参考文章的直接链接 title=参考文章的直接链接>​</a></h2>
<table><thead><tr><th>作者（文章名称）<th>连接<tbody><tr><td>controZL<td><a href=https://juejin.cn/post/6915795898609975309 target=_blank rel="noopener noreferrer">https://juejin.cn/post/6915795898609975309</a><tr><td>阿宝哥<td><a href=https://juejin.cn/post/6980142557066067982 target=_blank rel="noopener noreferrer">https://juejin.cn/post/6980142557066067982</a><tr><td>阿宝哥<td><a href=https://juejin.cn/post/6971935704938971173 target=_blank rel="noopener noreferrer">JavaScript 如何检测文件的类型？</a><tr><td>你不知道的 Blob<td><a href=http://caibaojian.com/blob.html target=_blank rel="noopener noreferrer">http://caibaojian.com/blob.html</a><tr><td>苏苏同学<td><a href=https://juejin.cn/post/7046313942938812424 target=_blank rel="noopener noreferrer">https://juejin.cn/post/7046313942938812424</a><tr><td>灵扁扁<td><a href=https://juejin.cn/post/7086879982768783391 target=_blank rel="noopener noreferrer">js实现导入导出excel文件</a></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href="https://github.com/my-docs/JavaScript & TypeScript/4.4-数据通信.md" target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_ImGc aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_fLB1"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=文件选项卡><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/JavaScript & TypeScript/4.3-迭代器"><div class=pagination-nav__sublabel>上一页</div><div class=pagination-nav__label>4.3-迭代器</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/JavaScript & TypeScript/4.5-二进制对象"><div class=pagination-nav__sublabel>下一页</div><div class=pagination-nav__label>4.5-二进制对象</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_vnXa thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#文件处理 class="table-of-contents__link toc-highlight">文件处理</a><li><a href=#上传文件 class="table-of-contents__link toc-highlight">上传文件</a><ul><li><a href=#单文件上传 class="table-of-contents__link toc-highlight">单文件上传</a><li><a href=#大文件上传 class="table-of-contents__link toc-highlight">大文件上传</a><li><a href=#文件切片 class="table-of-contents__link toc-highlight"><strong>文件切片</strong></a><li><a href=#还原切片 class="table-of-contents__link toc-highlight"><strong>还原切片</strong></a><li><a href=#断点续传 class="table-of-contents__link toc-highlight"><strong>断点续传</strong></a><li><a href=#上传进度和��暂停 class="table-of-contents__link toc-highlight"><strong>上传进度和暂停</strong></a></ul><li><a href=#应用场景 class="table-of-contents__link toc-highlight">应用场景</a><ul><li><a href=#保存文件 class="table-of-contents__link toc-highlight">保存文件</a><li><a href=#分片上传 class="table-of-contents__link toc-highlight">分片上传</a><li><a href=#下载数据 class="table-of-contents__link toc-highlight">下载数据</a><li><a href=#导出为-excel class="table-of-contents__link toc-highlight">导出为 Excel</a></ul><li><a href=#参考文章 class="table-of-contents__link toc-highlight">参考文章</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>社区</div><ul class="footer__items clean-list"><li class=footer__item><a href="https://space.bilibili.com/488063421?spm_id_from=333.1007.0.0" target=_blank rel="noopener noreferrer" class=footer__link-item>bilibili<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_yvLq><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://github.com/inshadow1 target=_blank rel="noopener noreferrer" class=footer__link-item>Github<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_yvLq><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div><div class="col footer__col"><div class=footer__title>联系</div><ul class="footer__items clean-list"><li class=footer__item><a href=# class=footer__link-item>微信号：q1601698207</a><li class=footer__item><a href=https://github.com/facebook/docusaurus target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_yvLq><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 Yelv. Built with Docusaurus.<br><a href=https://beian.miit.gov.cn>鄂ICP备2025094277号</a></div></div></div></footer></div>