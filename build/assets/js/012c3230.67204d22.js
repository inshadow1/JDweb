"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["2981"],{4403:function(e,n,r){r.r(n),r.d(n,{default:()=>h,frontMatter:()=>t,metadata:()=>s,assets:()=>c,toc:()=>i,contentTitle:()=>l});var s=JSON.parse('{"id":"JavaScript & TypeScript/3.7-\u8DE8\u7A97\u53E3\u4EA4\u4E92","title":"3.7-\u8DE8\u7A97\u53E3\u4EA4\u4E92","description":"Create by fall on \u2014 \u2014 2020","source":"@site/my-docs/JavaScript & TypeScript/3.7-\u8DE8\u7A97\u53E3\u4EA4\u4E92.md","sourceDirName":"JavaScript & TypeScript","slug":"/JavaScript & TypeScript/3.7-\u8DE8\u7A97\u53E3\u4EA4\u4E92","permalink":"/docs/JavaScript & TypeScript/3.7-\u8DE8\u7A97\u53E3\u4EA4\u4E92","draft":false,"unlisted":false,"editUrl":"https://github.com/my-docs/JavaScript & TypeScript/3.7-\u8DE8\u7A97\u53E3\u4EA4\u4E92.md","tags":[],"version":"current","sidebarPosition":62,"frontMatter":{"sidebar_position":62},"sidebar":"tutorialSidebar","previous":{"title":"3.6-\u6D4F\u89C8\u5668\u7684\u5B58\u50A8","permalink":"/docs/JavaScript & TypeScript/3.6-\u6D4F\u89C8\u5668\u7684\u5B58\u50A8"},"next":{"title":"4.1-\u524D\u540E\u7AEF\u4EA4\u4E92","permalink":"/docs/JavaScript & TypeScript/4.1-\u524D\u540E\u7AEF\u4EA4\u4E92"}}'),a=r("5893"),o=r("65");let t={sidebar_position:62},l=void 0,c={},i=[{value:"\u7A97\u53E3\u7684\u4EA4\u4E92",id:"\u7A97\u53E3\u7684\u4EA4\u4E92",level:2},{value:"\u540E\u7AEF\u65B9\u6848",id:"\u540E\u7AEF\u65B9\u6848",level:3},{value:"\u4E8B\u4EF6 + \u5BA2\u6237\u7AEF\u5B58\u50A8",id:"\u4E8B\u4EF6--\u5BA2\u6237\u7AEF\u5B58\u50A8",level:3},{value:"postMessage",id:"postmessage",level:3},{value:"Broadcast Channel",id:"broadcast-channel",level:3},{value:"SharedWorker",id:"sharedworker",level:3},{value:"MessageChannel",id:"messagechannel",level:3},{value:"localStorage &amp; sessionStorage",id:"localstorage--sessionstorage",level:3},{value:"\u53C2\u8003\u6587\u7AE0",id:"\u53C2\u8003\u6587\u7AE0",level:2}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Create by ",(0,a.jsx)(n.strong,{children:"fall"})," on \u2014 \u2014 2020\r\nRecently revised in 16 Jan 2023"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"\u7A97\u53E3\u7684\u4EA4\u4E92",children:"\u7A97\u53E3\u7684\u4EA4\u4E92"}),"\n",(0,a.jsx)(n.p,{children:"\u5B9E\u73B0\u6D4F\u89C8\u5668\u4E24\u4E2A\u7A97\u53E3\u7684\u4EA4\u4E92"}),"\n",(0,a.jsx)(n.h3,{id:"\u540E\u7AEF\u65B9\u6848",children:"\u540E\u7AEF\u65B9\u6848"}),"\n",(0,a.jsx)(n.p,{children:"Web Socket\uFF0C\u4E00\u79CD\u5728\u5355\u4E2A TCP \u8FDE\u63A5\u4E0A\u8FDB\u884C\u5168\u53CC\u5DE5\u901A\u8BAF\u7684\u534F\u8BAE\u3002"}),"\n",(0,a.jsx)(n.h3,{id:"\u4E8B\u4EF6--\u5BA2\u6237\u7AEF\u5B58\u50A8",children:"\u4E8B\u4EF6 + \u5BA2\u6237\u7AEF\u5B58\u50A8"}),"\n",(0,a.jsx)(n.p,{children:"\u5176\u4E2D hook \u53EF\u4EE5\u4E3A SetTimeout\uFF0C\u52A0\u4E0A\u5BA2\u6237\u7AEF\u5B58\u50A8\uFF0C\u6216\u8005\u662F\u5168\u5C40\u4E8B\u4EF6\uFF0Cvisibilitychange\uFF08\u53EF\u89C6\u66F4\u6539\uFF09\u7B49\u4E8B\u4EF6\u94A9\u5B50"}),"\n",(0,a.jsx)(n.p,{children:"\u5BA2\u6237\u7AEF\u5B58\u50A8\uFF1Acookie\u3001localStorage\u3001sessionStorage\u3001indexDB"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"storage + event"})}),"\n",(0,a.jsx)(n.p,{children:"\u901A\u8FC7\u4E8B\u4EF6\u76D1\u542C"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const message = {\r\n  name:\"Fall\"\r\n}\r\nlocalStorage.setItem('message',JSON.stringify(message))\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const storageWatch = (ev)=>{\r\n  console.log(ev.key, ev.newValue, ev.oldValue) // \u8FD8\u6709\u4E24\u4E2A\u5C5E\u6027\uFF0C\r\n  // storageArea\uFF1A\u88AB\u64CD\u4F5C\u7684 storage \u5BF9\u8C61\r\n  // url\uFF1Akey\u53D1\u751F\u6539\u53D8\u7684\u5BF9\u8C61\u6240\u5728\u6587\u6863\u7684 URL \u5730\u5740\r\n}\r\naddEventListener('storage',storageWatch)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"postmessage",children:"postMessage"}),"\n",(0,a.jsx)(n.p,{children:"postMessage \u9700\u8981\u62FF\u5230 window \u5BF9\u8C61\uFF0C\u4E5F\u6CE8\u5B9A\u4ED6\u4F7F\u7528\u7684\u9650\u5236\uFF0C \u4E24\u4E2A\u7A97\u4F53\u5FC5\u987B\u5EFA\u7ACB\u8D77\u8054\u7CFB\u3002\u5FC5\u987B\u4FDD\u8BC1\u540C\u6E90"}),"\n",(0,a.jsx)(n.p,{children:"\u5EFA\u7ACB\u8054\u7CFB\u7684\u65B9\u5F0F"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"window.open"}),"\n",(0,a.jsx)(n.li,{children:"window.opener"}),"\n",(0,a.jsx)(n.li,{children:"iframe"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"// \u5B50\u7EC4\u4EF6\uFF0C\u901A\u8FC7\u83B7\u53D6\u7236\u7EC4\u4EF6 window \u4EE5\u53D1\u51FA\u4FE1\u606F\r\nwindow.addEventListener(\"load\", iframeLoaded, false);\r\nfunction iframeLoaded() {\r\n  window.parent.postMessage('Hello from the main page!', '*');\r\n  console.log('\u6211\u53D1\u5E03\u4E86\u4FE1\u606F');\r\n}\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"// \u7236\u7EC4\u4EF6\uFF0C\u76D1\u542C message \u4E8B\u4EF6\uFF0C\r\naddEventListener('message', handleMessage, false);\r\nfunction handleMessage(e) {\r\n  console.log(e, e.data)\r\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u7236\u4F20\u5B50\u4E5F\u7C7B\u4F3C\uFF0C\u901A\u8FC7 ",(0,a.jsx)(n.code,{children:"iframe.contentWindow"})," \u83B7\u53D6\u5B50\u5143\u7D20 ",(0,a.jsx)(n.code,{children:"window"})," \u5BF9\u8C61\uFF0C\u4F7F\u7528\u8BE5 ",(0,a.jsx)(n.code,{children:"window.postMessage"})," \u8FDB\u884C\u901A\u4FE1"]}),"\n",(0,a.jsx)(n.h3,{id:"broadcast-channel",children:"Broadcast Channel"}),"\n",(0,a.jsx)(n.p,{children:"\u7ED9\u591A\u7A97\u53E3\u7528\u7684\uFF0CService Woker \u4E5F\u53EF\u4EE5\u4F7F\u7528\u3002\u9075\u5FAA\u540C\u6E90\u7B56\u7565"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"// Page1\r\nvar channel = new BroadcastChannel(\"channel-BroadcastChannel\"); // \u786E\u4FDD\u4E24\u4E2A\u9875\u9762\u7684\u9891\u9053\u540D\u79F0\u4E00\u81F4\r\nchannel.postMessage('Hello, BroadcastChannel!')\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'// Page2\r\nvar channel = new BroadcastChannel("channel-BroadcastChannel");\r\nchannel.addEventListener("message", function(ev) {\r\n  console.log(ev.data)\r\n});\r\n// \u5904\u7406\u4E8B\u4EF6\u4E5F\u53EF\u4EE5\u5199\u4E3A\uFF1A\r\nchannel.onmessage=function(ev) {\r\n  console.log(ev.data)\r\n  // do something\r\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"sharedworker",children:"SharedWorker"}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u5B66\u4E60\u5B8C Web Worker \u540E\u8FDB\u884C\u8865\u5145"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u8FD9\u662F Web Worker \u4E4B\u540E\u51FA\u6765\u7684\u5171\u4EAB\u7684 Worker\uFF0C\u591A\u7EBF\u7A0B\u89E3\u51B3\u65B9\u6848\uFF0C\u53EF\u4EE5\u5728\u4E0D\u901A\u9875\u9762 tab \u4E4B\u95F4\u5171\u4EAB\u8FD9\u4E2A Worker\uFF0C\u4ECE\u800C\u5B9E\u73B0\u8DE8\u9875\u9762\u901A\u4FE1\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"let  worker = new SharedWorker('/shared-worker.js', 'tabWorker');\r\n// \u63A5\u6536\u4E8B\u4EF6\r\nworker.port.onmessage = function (event) {\r\n  console.log('\u63A5\u6536\u5230 event', event);\r\n  // do something\r\n};\r\n// \u53D1\u9001\u4E8B\u4EF6\r\nworker.port.postMessage(data);\n"})}),"\n",(0,a.jsx)(n.p,{children:"shared worker \u9700\u8981\u989D\u5916\u5B9A\u4E49"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"// shared-worker.js\r\nconst connections = [];\r\n// \u6709\u65B0\u7684\u8FDE\u63A5\u4F1A\u89E6\u53D1\u8BE5\u4E8B\u4EF6\r\nonconnect = function (event) {\r\n  var port = event.ports[0];\r\n  connections.push(port);\r\n\r\n  port.onmessage = function (event) {\r\n    // \u63A5\u6536\u5230\u6D88\u606F\u65F6\uFF0C\u5411\u6240\u6709\u8FDE\u63A5\u53D1\u9001\u8BE5\u6D88\u606F\r\n    connections.forEach(function (conn) {\r\n      if (conn !== port) {\r\n        conn.postMessage(event.data);\r\n      }\r\n    });\r\n  };\r\n	// \u542F\u7528\u76D1\u542C\r\n  port.start();\r\n};\n"})}),"\n",(0,a.jsx)(n.h3,{id:"messagechannel",children:"MessageChannel"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"MessageChannel"})," \u63A5\u53E3\u5141\u8BB8\u6211\u4EEC\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u6D88\u606F\u901A\u9053\uFF0C\u5E76\u901A\u8FC7\u5B83\u7684\u4E24\u4E2A ",(0,a.jsx)(n.code,{children:"MessagePort"})," \u5C5E\u6027\u53D1\u9001\u6570\u636E\u3002\u9700\u8981\u5148\u901A\u8FC7 postMessage \u5148\u5EFA\u7ACB\u8054\u7CFB\u3002"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["\u6B64\u7279\u6027\u5728 ",(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API",children:"Web Worker"})," \u4E2D\u53EF\u7528"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"let { port1: receivePort, port2: sendPort } = new MessageChannel();\r\n// \u8FD4\u56DE\u4E00\u4E2A\u5177\u6709 port1\u3001port2 \u7684\u5BF9\u8C61\uFF0C\u53EF\u4EE5\u901A\u8FC7\u4E24\u4E2A\u5BF9\u8C61\u8FDB\u884C\u4F20\u8F93\r\n\r\nvar ifr = document.querySelector('iframe');\r\nvar otherWindow = ifr.contentWindow;\r\nifr.addEventListener(\"load\", iframeLoaded, false);\r\nfunction iframeLoaded() {\r\n  otherWindow.postMessage('Hello from the main page!', '*', [sendPort]);\r\n  console.log('\u53D1\u9001\u6210\u529F');\r\n}\r\nreceivePort.onmessage = handleMessage;\r\nfunction handleMessage(e) {\r\n  console.log(e.data)\r\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"localstorage--sessionstorage",children:"localStorage & sessionStorage"}),"\n",(0,a.jsxs)(n.p,{children:["\u5B9E\u73B0\u65B9\u6CD5\uFF0C\u57FA\u4E8E localStorage \u53D8\u5316\u65F6\u89E6\u53D1\u7684\u4E8B\u4EF6\uFF0C",(0,a.jsx)(n.code,{children:"window.addEventListener('storage', *function*(*event*) {})"})," \u4E8B\u4EF6\u5B9E\u73B0\u4E86 localStore \u53D8\u5316\u65F6\u5019\u7684\u6570\u636E\u76D1\u542C\uFF1B"]}),"\n",(0,a.jsx)(n.h2,{id:"\u53C2\u8003\u6587\u7AE0",children:"\u53C2\u8003\u6587\u7AE0"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"\u4F5C\u8005"}),(0,a.jsx)(n.th,{children:"\u94FE\u63A5"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"\u4E91\u7684\u4E16\u754C"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"https://juejin.cn/post/7002012595200720927",children:"https://juejin.cn/post/7002012595200720927"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"MDN"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/MessageChannel",children:"https://developer.mozilla.org/zh-CN/docs/Web/API/MessageChannel"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Coco"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/669185635",children:"\u6D4F\u89C8\u5668\u8DE8 Tab \u7A97\u53E3\u901A\u4FE1\u539F\u7406\u53CA\u5E94\u7528\u5B9E\u8DF5"})})]})]})]})]})}function h(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},65:function(e,n,r){r.d(n,{Z:function(){return l},a:function(){return t}});var s=r(7294);let a={},o=s.createContext(a);function t(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);