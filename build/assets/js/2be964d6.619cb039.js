"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["8479"],{7268:function(e,n,l){l.r(n),l.d(n,{default:()=>a,frontMatter:()=>s,metadata:()=>r,assets:()=>p,toc:()=>t,contentTitle:()=>u});var r=JSON.parse('{"id":"npm \u5305/rollup","title":"rollup","description":"Create by fall on  17 Feb 2022","source":"@site/my-docs/npm \u5305/rollup.md","sourceDirName":"npm \u5305","slug":"/npm \u5305/rollup","permalink":"/docs/npm \u5305/rollup","draft":false,"unlisted":false,"editUrl":"https://github.com/my-docs/npm \u5305/rollup.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"prettier","permalink":"/docs/npm \u5305/prettier"},"next":{"title":"sass","permalink":"/docs/npm \u5305/sass"}}'),o=l("2676"),i=l("3663");let s={},u=void 0,p={},t=[{value:"Rollup",id:"rollup",level:2},{value:"TreeShaking",id:"treeshaking",level:3},{value:"\u63D2\u4EF6",id:"\u63D2\u4EF6",level:2},{value:"@rollup/plugin-json",id:"rollupplugin-json",level:3},{value:"@rollup/plugin-node-resolve",id:"rollupplugin-node-resolve",level:3},{value:"@rollup/plugin-alias",id:"rollupplugin-alias",level:3},{value:"rollup-plugin-polyfill-node",id:"rollup-plugin-polyfill-node",level:3},{value:"rollup-plugin-visualizer",id:"rollup-plugin-visualizer",level:3},{value:"@rollup/browser",id:"rollupbrowser",level:3},{value:"@rollup/plugin-sucrase",id:"rollupplugin-sucrase",level:3}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["Create by ",(0,o.jsx)(n.strong,{children:"fall"})," on  17 Feb 2022\r\nRecently revised in 18 Dec 2023"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"rollup",children:"Rollup"}),"\n",(0,o.jsx)(n.p,{children:"\u4F7F\u7528 Rollup@4 \u8981\u5C06 node \u5347\u7EA7\u5230 V18 \u4EE5\u4E0A"}),"\n",(0,o.jsx)(n.p,{children:"Rollup \u662F\u4E00\u6B3E\u57FA\u4E8E ESmodule \u7684\u6253\u5305\u8F6F\u4EF6\uFF08webpack \u57FA\u4E8E commonjs\uFF09"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'import pkg from "./package.json" assert { type: \'json\' };\r\n// \u5728 package.json \u4E2D\u914D\u7F6E main\uFF0C\u4F5C\u4E3A cjs \u9ED8\u8BA4\u5BFC\u5165\u5185\u5BB9\uFF0Cmodule \u4F5C\u4E3A esm \u5BFC\u5165\u5185\u5BB9\r\nimport json from "@rollup/plugin-json";\r\nimport resolve from "@rollup/plugin-node-resolve";\r\nimport commonjs from "@rollup/plugin-commonjs";\r\nimport { babel } from \'@rollup/plugin-babel\'\r\nimport vuePlugin from \'rollup-plugin-vue\'\r\n// vue-plugin-vue \u63CF\u8FF0\u4E86\u9700\u8981\u54EA\u4E9B\u5305\r\nexport default {\r\n  input: "./src/immer/index.vue",\r\n  output: [{\r\n      file: pkg.main,\r\n      format: "cjs",\r\n    },{\r\n      file: pkg.module,\r\n      format: "esm",\r\n      // \u5C06\u8FD9\u4E9B\u5305\u4F5C\u4E3A\u5355\u72EC\u7684\u5305\u5BFC\u51FA\r\n      manualChunks: {\r\n				lodash: [\'lodash\']\r\n			}\r\n    },\r\n  ],\r\n  plugins: [\r\n    vuePlugin(/* options */), // \u7528\u4E8E\u89E3\u6790 .vue \u6587\u4EF6\r\n    json(),\r\n    commonjs({\r\n      include: /node_modules/,\r\n    }),\r\n    resolve({\r\n      preferBuiltins: true,\r\n      jsnext: true,\r\n      main: true,\r\n      brower: true,\r\n    }),\r\n    babel({ exclude: "node_modules/**" }),\r\n  ],\r\n  // \u8B66\u544A\u5904\u7406\r\n  // onwarn(warning, warn) {}\r\n};\n'})}),"\n",(0,o.jsx)(n.h3,{id:"treeshaking",children:"TreeShaking"}),"\n",(0,o.jsx)(n.p,{children:"Rollup \u5FC5\u987B\u4FDD\u5B88\u5730\u5220\u9664\u4EE3\u7801\uFF0C\u4EE5\u786E\u4FDD\u6700\u7EC8\u7ED3\u679C\u5C06\u6B63\u786E\u8FD0\u884C\u3002\u65E0\u8BBA\u662F\u5BF9\u4F60\u6B63\u5728\u4F7F\u7528\u7684\u6A21\u5757\u4E2D\u7684\u67D0\u4E9B\u90E8\u5206\u8FD8\u662F\u5BF9\u5168\u5C40\u73AF\u5883\uFF0CRollup \u90FD\u4F1A\u4F7F\u8FD9\u4E9B\u526F\u4F5C\u7528\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u5927\u578B\u9879\u76EE\u53EF\u80FD\u4F1A\u8FBE\u5230 Node \u7684\u5185\u5B58\u9650\u5236\uFF0C\u4F7F\u7528\u4EE5\u4E0B\u65B9\u5F0F\u8FD0\u884C\u5373\u53EF\u3002\r\nnode --max-old-space-size=8192 node_modules/rollup/dist/bin/rollup -c\r\n# \u8BF7\u6CE8\u610F\uFF0C\u8FD9\u4E2A\u6570\u5B57\u53EF\u4EE5\u5B89\u5168\u5730\u8D85\u8FC7\u4F60\u7684\u53EF\u7528\u7269\u7406\u5185\u5B58\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0CNode \u4F1A\u6839\u636E\u9700\u8981\u5C06\u5185\u5B58\u5206\u9875\u5230\u78C1\u76D8\u4E0A\u3002\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u63D2\u4EF6",children:"\u63D2\u4EF6"}),"\n",(0,o.jsx)(n.p,{children:"\u63D2\u4EF6\u5206\u4E3A\u5B98\u65B9\u63D2\u4EF6\uFF08\u4EE5 @rollup/plugin \u5F00\u5934\uFF09\u548C\u793E\u533A\u63D2\u4EF6\uFF08rollup-plugin \u5F00\u5934\uFF09"}),"\n",(0,o.jsx)(n.h3,{id:"rollupplugin-json",children:"@rollup/plugin-json"}),"\n",(0,o.jsx)(n.p,{children:"\u53EF\u4EE5\u5904\u7406 JSON \u6587\u4EF6"}),"\n",(0,o.jsx)(n.h3,{id:"rollupplugin-node-resolve",children:"@rollup/plugin-node-resolve"}),"\n",(0,o.jsx)(n.p,{children:"\u53EF\u4EE5\u89E3\u6790 node \u4E2D\u7684\u5305\uFF0C\u5C06\u4EE3\u7801\u6253\u5305\u5230\u4EA7\u7269\u4E2D"}),"\n",(0,o.jsx)(n.h3,{id:"rollupplugin-alias",children:"@rollup/plugin-alias"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"{\r\n  plugins: [\r\n    vuePlugin({\r\n      target: 'broswer'\r\n    }),\r\n    sucrase({\r\n      exclude: ['node_modules/**'],\r\n      transforms: ['jsx']\r\n    }),\r\n    alias({\r\n      entries: [\r\n        // { find: 'packages/', replacement: '@/' },\r\n        { find: '@', replacement: __dirname + '/packages' },\r\n        { find: 'utils', replacement: __dirname + '/packages/utils/index.js' },\r\n      ]\r\n    }),\r\n    // \u8BA9 Rollup \u67E5\u627E\u5230\u5916\u90E8\u6A21\u5757\uFF0C\u6253\u5305\u5230\u4EA7\u7269\u5185\r\n    resolve({\r\n      // \u5C06\u81EA\u5B9A\u4E49\u9009\u9879\u4F20\u9012\u7ED9\u89E3\u6790\u63D2\u4EF6\r\n      moduleDirectories: ['node_modules']\r\n    })\r\n    // alias({\r\n    //   entries: [\r\n    //     { find: 'utils', replacement: '../../../utils' },\r\n    //     { find: 'batman-1.0.0', replacement: './joker-1.5.0' }\r\n    //   ]\r\n    // })\r\n  ]\r\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"rollup-plugin-polyfill-node",children:"rollup-plugin-polyfill-node"}),"\n",(0,o.jsx)(n.p,{children:"\u5982\u679C\u60F3\u8981\u5728\u9879\u76EE\u4E2D\u4F7F\u7528 node \u7684"}),"\n",(0,o.jsx)(n.h3,{id:"rollup-plugin-visualizer",children:"rollup-plugin-visualizer"}),"\n",(0,o.jsx)(n.p,{children:"\u7528\u6765\u67E5\u770B\u6253\u5305\u540E\u7684\u5305\u4F53\u79EF\u5927\u5C0F"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js"})}),"\n",(0,o.jsx)(n.h3,{id:"rollupbrowser",children:"@rollup/browser"}),"\n",(0,o.jsxs)(n.p,{children:["\u9762\u5411\u6D4F\u89C8\u5668\u7684\u6784\u5EFA\uFF08NPM \u4E0A\u7684 ",(0,o.jsx)(n.code,{children:"@rollup/browser"}),"\uFF09\u73B0\u5728\u4F9D\u8D56\u4E8E\u4E00\u4E2A\u9700\u8981\u63D0\u4F9B\u7684 WASM \u6587\u4EF6\u3002\u5982\u679C\u4F60\u6B63\u5728\u4F7F\u7528 Vite \u7684\u6D4F\u89C8\u5668\u6784\u5EFA\uFF0C\u4F60\u9700\u8981\u5C06 ",(0,o.jsx)(n.code,{children:'"@rollup/browser"'})," \u6DFB\u52A0\u5230 ",(0,o.jsx)(n.code,{children:"optimizeDeps.exclude"})," \u4E2D\uFF0C\u5426\u5219 ",(0,o.jsx)(n.code,{children:"npm run dev"})," \u5C06\u56E0\u4E3A ",(0,o.jsx)(n.code,{children:".wasm"})," \u6587\u4EF6\u7684\u65E0\u6548\u8DEF\u5F84\u800C\u5931\u8D25\uFF08\u8BF7\u53C2\u9605 ",(0,o.jsx)(n.a,{href:"https://github.com/vitejs/vite/issues/14609",children:"vitejs #14609"}),"\uFF09\u3002"]}),"\n",(0,o.jsx)(n.h3,{id:"rollupplugin-sucrase",children:"@rollup/plugin-sucrase"})]})}function a(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},3663:function(e,n,l){l.d(n,{Z:function(){return u},a:function(){return s}});var r=l(5271);let o={},i=r.createContext(o);function s(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function u(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);