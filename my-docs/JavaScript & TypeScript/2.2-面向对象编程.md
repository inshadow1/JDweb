---
sidebar_position: 32
---

> Create by **fall** on 08 Sep 2021
> Recently revised in 12 Jan 2023

## å…³é”®å­—

### instanceof

é€šè¿‡è¯¥å…³é”®å­—å¯ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯ç»§æ‰¿å…³ç³»

```js
Array instanceof Object // true
let person = function(){}
let no = new person()
no instanceof person//true
```

instanceOf åŸç†

```js
function new_instance_of(leftVaule, rightVaule) { 
    let rightProto = rightVaule.prototype; // å–å³è¡¨è¾¾å¼çš„ prototype å€¼
    leftVaule = leftVaule.__proto__; // å–å·¦è¡¨è¾¾å¼çš„__proto__å€¼
    while (true) {
        if (leftVaule === null) {
            return false;    
        }
        if (leftVaule === rightProto) {
            return true;    
        } 
        leftVaule = leftVaule.__proto__ 
    }
}
```

å…¶å® instanceof ä¸»è¦çš„å®ç°åŸç†å°±æ˜¯åªè¦å³è¾¹å˜é‡çš„ prototype åœ¨å·¦è¾¹å˜é‡çš„åŸå‹é“¾ä¸Šå³å¯ã€‚å› æ­¤ï¼Œinstanceof  åœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­ä¼šéå†å·¦è¾¹å˜é‡çš„åŸå‹é“¾ï¼Œç›´åˆ°æ‰¾åˆ°å³è¾¹å˜é‡çš„ prototypeï¼Œå¦‚æœæŸ¥æ‰¾å¤±è´¥ï¼Œåˆ™ä¼šè¿”å›  falseï¼Œå‘Šè¯‰æˆ‘ä»¬å·¦è¾¹å˜é‡å¹¶éæ˜¯å³è¾¹å˜é‡çš„å®ä¾‹ã€‚

### new

åœ¨ JS ä¸­ï¼Œå‡½æ•°æœ¬èº«å°±æ˜¯æ„é€ å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ new è¿›è¡Œå£°æ˜æ„é€ å‡½æ•°ã€‚

`new` çš„ä½œç”¨å®é™…ä¸Šå°±æ˜¯æŠŠ function è½¬æ¢ä¸ºä¸€ä¸ªå¯¹è±¡

è‡ªå·±ç”Ÿæˆä¸€ä¸ª new

```js
function myNew(fun,...args){
  let obj = {} 
  const res = fun.call(obj,...args)
  obj.__proto__ = fun.prototype
  // å¦‚æœå­˜åœ¨è¿”å›å€¼
  if(res){
    // operate
  }
  return obj
}
function Person(name){
  this.name = name
  this.showName= ()=>{
    console.log(name);
  }
}
Person.prototype.say =function(){
  console.log(this.name+'è¯´ï¼šæˆ‘æ²¡é’±äº†');
}
const liu = myNew(Person,'ç‹—å‰©')
liu.showName()
liu.say()
```

ES6 ä¸º `new` å‘½ä»¤å¼•å…¥äº†ä¸€ä¸ª `new.target` å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸€èˆ¬ç”¨åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œè¿”å› `new` è°ƒç”¨çš„é‚£ä¸ªæ„é€ å‡½æ•°ã€‚

å¦‚æœæ„é€ å‡½æ•°ä¸æ˜¯é€šè¿‡`new`å‘½ä»¤æˆ–`Reflect.construct()`è°ƒç”¨çš„ï¼Œ`new.target`ä¼šè¿”å›`undefined`ï¼Œæ‰€ä»¥è¿™ä¸ªå±æ€§å¯ä»¥ç”¨æ¥ç¡®å®šæ„é€ å‡½æ•°æ˜¯æ€ä¹ˆè°ƒç”¨çš„ï¼Œé‡åˆ°ç®­å¤´å‡½æ•°ä¼šæŠ›é”™ã€‚

```js
function fn(name) {
  console.log('fn:',new.target)
}
fn('nanjiu') // undefined
new fn('nanjiu') 
/*
fn: Æ’ fn(name) {
    console.log('fn:',new.target)
}
*/
let fn2 = (name) => {
  console.log('fn2',new.target)
}
fn2('nan') // æŠ¥é”™ Uncaught SyntaxError: new.target expression is not allowed here
```

## Class

> ES6 å®ç°çš„é¢å‘å¯¹è±¡æ–¹å¼ï¼ŒClass æ˜¯ ES6 ä¸­åˆ›å»ºç±»çš„è¯­æ³•ç³–

### è¯­æ³•ç‰¹æ€§

å¯ä»¥ç”¨ `class` å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œç±»æ˜¯å¯¹ä¸€ç±»å…·æœ‰å…±åŒç‰¹å¾çš„äº‹ç‰©çš„æŠ½è±¡ï¼Œå°±æ¯”å¦‚å¯ä»¥æŠŠç‹—å®šä¹‰ä¸ºä¸€ä¸ªç±»ï¼Œç‹—æœ‰åå­—ä¼šå«ä¹Ÿä¼šè·³ï¼›ç±»æ˜¯ç‰¹æ®Šçš„å‡½æ•°ï¼Œå°±åƒå‡½æ•°å®šä¹‰çš„æ—¶å€™æœ‰å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼ä¸€æ ·ï¼Œç±»çš„å®šä¹‰ä¹Ÿæœ‰ç±»å£°æ˜å’Œç±»è¡¨è¾¾å¼ï¼Œä¸è¿‡ç±»å£°æ˜ä¸åŒäºå‡½æ•°å£°æ˜ï¼Œå®ƒæ˜¯æ— æ³•æå‡çš„ï¼›ç±»ä¹Ÿæœ‰ `name` å±æ€§

```js
// ç±»å£°æ˜
class Dog {
  constructor(name) { // åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¼šæ„é€ ä¸€æ¬¡
    this.name = name
  }
  bark() {}
  jump() {}
}
Dog.name  // 'Dog'
// ç±»è¡¨è¾¾å¼ï¼šå¯ä»¥å‘½åï¼ˆç±»çš„ name å±æ€§å–ç±»åï¼‰ï¼Œä¹Ÿå¯ä»¥ä¸å‘½åï¼ˆç±»çš„ name å±æ€§å–å˜é‡åï¼‰
let Animal2 = class {
  // xxx
}
Animal2.name  // 'Animal2'
```

`JS` ä¸­çš„ç±»å»ºç«‹åœ¨åŸå‹çš„åŸºç¡€ä¸Šï¼ˆé€šè¿‡å‡½æ•°æ¥æ¨¡æ‹Ÿç±»ï¼Œå…¶å®ç±»å°±æ˜¯æ„é€ å‡½æ•°çš„è¯­æ³•ç³–ï¼‰ï¼Œå’Œ `ES5` ä¸­æ„é€ å‡½æ•°ç±»ä¼¼ï¼Œä½†æ˜¯ä¹Ÿæœ‰åŒºåˆ«ï¼Œæ¯”å¦‚ç±»çš„å†…éƒ¨æ–¹æ³•æ˜¯ä¸å¯è¢«è¿­ä»£çš„ï¼š

```js
class Dog {
  constructor() {}
  bark() {}
  jump() {}
}
Object.keys(Dog.prototype)  // [] ç±»çš„å†…éƒ¨æ–¹æ³•æ˜¯ä¸å¯è¢«è¿­ä»£çš„

// ç±»ä¼¼äº
function Dog2(){}
Dog2.prototype = {
  constructor() {},
  bark() {},
  jump() {},
}
Object.keys(Dog2.prototype)  // ['constructor', 'bark', 'jump'] functionå¯ä»¥è¢«è¿­ä»£
```

åŸºäºåŸå‹ç»™ç±»æ·»åŠ æ–°æ–¹æ³•

```js
Object.assign(Dog.prototype, {
  eat() {} 
})
```

- ç±»å£°æ˜å’Œç±»è¡¨è¾¾å¼çš„ä¸»ä½“éƒ½æ‰§è¡Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ã€‚æ¯”å¦‚ï¼Œæ„é€ å‡½æ•°ï¼Œé™æ€æ–¹æ³•ï¼ŒåŸå‹æ–¹æ³•ï¼Œ`getter`å’Œ `setter` éƒ½åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æ‰§è¡Œã€‚
- ç±»å†…éƒ¨çš„ `this` é»˜è®¤æŒ‡å‘ç±»å®ä¾‹ï¼Œæ‰€ä»¥å¦‚æœç›´æ¥è°ƒç”¨åŸå‹æ–¹æ³•æˆ–è€…é™æ€æ–¹æ³•ä¼šå¯¼è‡´ `this` æŒ‡å‘è¿è¡Œæ—¶çš„ç¯å¢ƒï¼Œè€Œç±»å†…éƒ¨æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œæ‰€ä»¥æ­¤æ—¶çš„ `this` ä¼šæ˜¯ `undefined`ï¼š

```js
class Dog {
  constructor(name) {
    this.name = name
  }
  bark() {
    console.log( `${this.name} is bark.` )
  }
  static jump() {
    console.log( `${this.name} is jump.` )
  }
}
let dog = new Dog('å¤§é»„')
let { bark } = dog
let { jump } = Dog
bark()  // TypeError: Cannot read property 'name' of undefined
jump()  // TypeError: Cannot read property 'name' of undefined
```

### æ–¹æ³•å’Œå…³é”®å­—

`constructor` æ–¹æ³•æ˜¯ç±»çš„é»˜è®¤æ–¹æ³•ï¼Œé€šè¿‡ `new` å…³é”®å­—ç”Ÿæˆå®ä¾‹çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ï¼›`constructor` é»˜è®¤ä¼šè¿”å›å®ä¾‹å¯¹è±¡ï¼š

```js
class Point {}
// ä¸€ä¸ªç±»å¿…é¡»æœ‰ constructor æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºå®šä¹‰ï¼Œåˆ™ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç©ºçš„ï¼ŒåŒä¸‹
class Point {
  constructor() {}
}
```

é€šè¿‡ `get` å’Œ `set` å…³é”®å­—æ‹¦æˆªæŸä¸ªå±æ€§çš„è¯»å†™æ“ä½œï¼š

```js
class Dog {
  get age(){
    return 1
  }
}
```

ç”¨ `static` å…³é”®å­—ç»™ç±»å®šä¹‰é™æ€æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸ä¼šå­˜åœ¨ç±»çš„åŸå‹ä¸Šï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡ç±»å®ä¾‹è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡ç±»åæ¥è°ƒç”¨ï¼Œé™æ€æ–¹æ³•å’ŒåŸå‹æ–¹æ³•å¯ä»¥åŒåï¼š

```js
class Dog {
  bark() {}
  jump() {
    console.log('åŸå‹æ–¹æ³•')
  }
  static jump() {
    console.log('é™æ€æ–¹æ³•')
  }
}
Object.getOwnPropertyNames(Dog.prototype)  // ['constructor', 'bark', 'jump']
Dog.jump()  // 'é™æ€æ–¹æ³•'
let dog = new Dog()
dog.jump()  // 'åŸå‹æ–¹æ³•'
```

`new.target` å±æ€§å…è®¸ä½ æ£€æµ‹å‡½æ•°ã€æ„é€ æ–¹æ³•æˆ–è€…ç±»æ˜¯å¦æ˜¯é€šè¿‡ `new` è¿ç®—ç¬¦è¢«è°ƒç”¨çš„ã€‚åœ¨é€šè¿‡ `new` è¿ç®—ç¬¦è¢«åˆå§‹åŒ–çš„å‡½æ•°æˆ–æ„é€ æ–¹æ³•ä¸­ï¼Œ`new.target` è¿”å›ä¸€ä¸ªæŒ‡å‘æ„é€ æ–¹æ³•æˆ–å‡½æ•°çš„å¼•ç”¨ã€‚åœ¨æ™®é€šçš„å‡½æ•°è°ƒç”¨ä¸­ï¼Œ`new.target` çš„å€¼æ˜¯ `undefined`ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ—¶å€™ä¼šè¿”å›å­ç±»ï¼š

```js
class Dog {
  constructor() {
    console.log(new.target.name)
  }
}
function fn(){
  if (!new.target) return 'new target is undefined'
  console.log('fn is called by new')
}
let dog = new Dog()  // 'Dog'
fn()                 // 'new target is undefined'
new fn()             // 'fn is called by new'
```

### ç±»çš„ç»§æ‰¿

ç±»å¯ä»¥é€šè¿‡ `extends` å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œå¦‚æœå­ç±»æ˜¾ç¤ºçš„å®šä¹‰äº† `constructor` åˆ™å¿…é¡»åœ¨å†…éƒ¨è°ƒç”¨ `super()` æ–¹æ³•ï¼Œå†…éƒ¨çš„ `this` æŒ‡å‘å½“å‰å­ç±»ï¼š

```js
class Animal {
  constructor(name) {
    this.name = name
  }
  run() {
    console.log(`${this.name} is running.`)
  }
}   
class Dog extends Animal{
  constructor(name){
    super(name)  // å¿…é¡»è°ƒç”¨ï¼Œå°±ç›¸å½“äºè°ƒç”¨äº† Animal çš„ constructor
    this.name = name
  }
  bark() {
    console.log(`${this.name} is barking.`)
  }
}
let dog = new Dog('å¤§é»„')
dog.run()  // 'å¤§é»„ is running.'
```

é€šè¿‡ `super()` è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æˆ–è€…é€šè¿‡ `super` è°ƒç”¨çˆ¶ç±»çš„åŸå‹æ–¹æ³•ï¼›å¦å¤–ä¹Ÿå¯ä»¥åœ¨å­ç±»çš„é™æ€æ–¹æ³•é‡Œé€šè¿‡ `super` è°ƒç”¨çˆ¶ç±»çš„é™æ€æ–¹æ³•ï¼š

```js
// åŸºäºä¸Šé¢çš„ä»£ç æ”¹é€ 
class Dog extends Animal{
  constructor(name){
    super(name)  // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
    this.name = name
  }
  bark() {
    super.run()  // è°ƒç”¨çˆ¶ç±»åŸå‹æ–¹æ³•
    console.log(`${this.name} is barking.`)
  }
}
let dog = new Dog()
dog.bark()s
// 'å¤§é»„ is running.'
// 'å¤§é»„ is barking.'
```

å­ç±»çš„ `__proto__` å±æ€§ï¼Œè¡¨ç¤ºæ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»ï¼›å­ç±» `prototype` å±æ€§çš„ `__proto__` å±æ€§ï¼Œè¡¨ç¤ºæ–¹æ³•çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»çš„prototypeå±æ€§ï¼š

```js
class Animal {}
class Dog extends Animal {}

Dog.__proto__ === Animal  // true
Dog.prototype.__proto__ === Animal.prototype  // true
```

å­ç±»åŸå‹çš„åŸå‹æŒ‡å‘çˆ¶ç±»çš„åŸå‹ï¼š

```js
// åŸºäºä¸Šé¢çš„ä»£ç 
let animal = new Animal()
let dog = new Dog()
dog.__proto__.__proto__  === animal.__proto__  // true
```

ä½¿ç”¨ `extends` è¿˜å¯ä»¥å®ç°ç»§æ‰¿åŸç”Ÿçš„æ„é€ å‡½æ•°ï¼Œå¦‚ä¸‹è¿™äº›æ„é€ å‡½æ•°éƒ½å¯ä»¥è¢«ç»§æ‰¿ï¼š

`String()`ã€`Number()`ã€`Boolean()`ã€`Array()`ã€`Object()`ã€`Function()`ã€`Date()`ã€`RegExp()`ã€`Error()`

```js
class MyString extends String {
  constructor(name){
    super(name)
    this.name = name
  }
  welcome() {
    return `hello ${this.name}`
  }
}
let ms = new MyString('å¸ƒå…°')
ms.welcome()      // 'hello å¸ƒå…°'
ms.length         // 2
ms.indexOf('å…°')  // 1
```

### é™æ€å­—æ®µ

ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨ï¼Œè¿™å°±ç§°ä¸ºâ€œé™æ€æ–¹æ³•â€ã€‚

ES 2022 æ”¯æŒé™æ€å­—æ®µ

```js
class MyString  {
  constructor(name){
    this.name = name
  }
  // é€šè¿‡åœ¨ç±»ä¸­ä½¿ç”¨ static å…³é”®å­—ï¼Œæ¥å£°æ˜é™æ€æ–¹æ³•
  static welcome() {
    return `hello ${this.name}`
  }
  hello() {
    return `hello ${this.name}`
  }
}
let ms = new MyString('å¸ƒå…°')
ms.welcome()      // 'hello å¸ƒå…°'
```

### ç§æœ‰å­—æ®µ

ES 2022 æ”¯æŒç§æœ‰å­—æ®µ

é™æ€å…¬æœ‰å­—æ®µå’Œé™æ€æ–¹æ³•ä¸€æ ·åªèƒ½é€šè¿‡ç±»åè°ƒç”¨ï¼›ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•åªèƒ½åœ¨ç±»çš„å†…éƒ¨è°ƒç”¨ï¼Œå¤–éƒ¨è°ƒç”¨å°†æŠ¥é”™ï¼š

```tsx
class Dog {
	age = 12                   // å…¬æœ‰å­—æ®µ
	static sex = 'male'        // é™æ€å…¬æœ‰å­—æ®µ
	#secret = 'æˆ‘æ˜¯äººç±»çš„å¥½æœ‹å‹'  // ç§æœ‰å­—æ®µ
	#getSecret() {              // ç§æœ‰æ–¹æ³•
		return this.#secret
	}
}
Dog.sex  // 'male'
let dog = new Dog()
dog.#getSecret()  // SyntaxError
```

```js
class SampleClass {
    /*
      instead of:
      constructor() { this.publicID = 42; }
    */
    publicID = 42; // public field
    /*
      instead of:
      static get staticPublicField() { return -1 }
    */
    static staticPublicField = -1;
    // static private field
    static #staticPrivateField = 'private';
    //private methods
    #privateMethod() {}
    // static block
    static {
      // executed when the class is created
    }
}
```

**ergonomic brand checks for private fields**

> Brand checks without exceptions. [ğŸ“•](https://github.com/tc39/proposal-private-fields-in-in)

```
class C {
  #brand;
  #method() {}
  get #getter() {}
  static isC(obj) {
    // in keyword to check
    return #brand in obj && #method in obj && #getter in obj;
  }
}
```

> å…¬å…±å’Œç§æœ‰å­—æ®µå£°æ˜æ˜¯ JavaScript æ ‡å‡†å§”å‘˜ä¼š TC39 æå‡ºçš„å®éªŒæ€§åŠŸèƒ½ï¼ˆç¬¬ 3 é˜¶æ®µï¼‰ã€‚æµè§ˆå™¨ä¸­çš„æ”¯æŒæ˜¯æœ‰é™çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ Babel ç­‰ç³»ç»Ÿæ„å»ºåä½¿ç”¨æ­¤åŠŸèƒ½ã€‚

## è£…é¥°å™¨

> JS çš„è£…é¥°å™¨è¿˜åœ¨ Stage 3 draft é˜¶æ®µï¼Œä½†æ˜¯ ts çš„å·²ç»å¯ä»¥ç”¨äº†ï¼Œè™½ç„¶å¯èƒ½è¿˜ä¼šå†æœ‰æ”¹åŠ¨
>
> è£…é¥°å™¨çš„ Polyfill ä½¿ç”¨çš„æ˜¯ defineProperty æˆ‘ä¸ªäººä¹Ÿä¸æ˜¯å¾ˆæ¸…æ¥š Proxy å’Œ defineProperty çš„ä½¿ç”¨ç•Œé™ï¼Œæˆ–è®¸ä¼šä¸€æ–¹ä»£æ›¿å¦ä¸€æ–¹ã€‚å½“ç„¶è¿™éƒ½æ— å…³ä»£ç å¼€å‘ã€‚

ä½¿ç”¨çš„æ—¶å€™è¦ææ¸…æ¥šä¸€ç‚¹ï¼Œè¿›è¡Œä¿®é¥°çš„å§‹ç»ˆæ˜¯ä¸ªæ–¹æ³•ï¼Œç”¨ `@` åé¢è·Ÿçš„æ˜¯ä¸ªæ–¹æ³•ï¼Œå› æ­¤ä¹Ÿæœ‰ä¸€éƒ¨åˆ†ä½¿ç”¨äº†é«˜é˜¶å‡½æ•°ï¼Œæƒ³äº†è§£é«˜é˜¶å‡½æ•°ï¼Œå¯ä»¥æŸ¥çœ‹

### ç±»çš„è£…é¥°å™¨

> å› ä¸ºæ²¡æœ‰å¯¹åº”çš„è£…é¥°å™¨ç¯å¢ƒï¼Œæ¨è¿Ÿæ›´æ–°ï¼Œç­‰å¾…ä¸‹æ¬¡å¡«å‘ï¼ˆ2022-01-27ï¼‰

```ts
// ä¸€èˆ¬ç”¨æ³•
// è£…é¥°å™¨ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥å¯¹ç±»è¿›è¡Œè£…é¥°ã€‚è¯¥æ–¹æ³•å†…çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç±»

const Knowlage = (specc)=>{
  specc.prototype.name = '411428'
  specc.prototype.speak = function(err){
    console.log(this.locate);
  }
}
@Knowlage
class Student{
  constructor(name){
    this.name = name
  }
  locate="æ²³åŒ—çœ"
  speak(){
    console.log('è€å­ä»€ä¹ˆéƒ½ä¸è¾“å‡º');
  }
}
// é«˜é˜¶å‡½æ•°ç”¨æ³•
const Wisdom = (name, age) => {
  console.log(age);
  return function (specc) {
    specc.prototype.test = '444';
    specc.prototype.speak = function (err) {
      console.log(this.locate);
    }
  }
}
@Wisdom('å¹³æ·¡', 66)
class Talent {
  constructor(name) {
    this.name = name;
  }
  locate = 'æ²³åŒ—çœ';
  name;
  speak() {
    console.log('è€å­ä»€ä¹ˆéƒ½ä¸è¾“å‡º');
  }
}
```

### å±æ€§çš„è£…é¥°å™¨



### è£…é¥°å™¨ç»„åˆ



å…¶ä»–çš„è¯­è¨€å·²ç»æœ‰è£…é¥°å™¨çš„æ¯”è¾ƒæˆç†Ÿçš„è§„èŒƒï¼ŒJSæ­£åœ¨è¿›è¡Œè·Ÿè¿›ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œéƒ½æ‹¿æ¥å§è€å­è¿˜æƒ³å­¦ï¼ˆç–¯æ‰.jpgï¼‰ã€‚

decoratorï¼Œç”¨äºè£…é¥°ä¸€ä¸ªç±»ï¼Œè£…é¥°å°±åœ¨äºï¼Œä½ å·²ç»æœ‰ä¸€ä¸ªéå¸¸å¤§çš„å¯¹è±¡äº†ï¼Œè€Œä½ æƒ³åœ¨å…¶ä¸­å‡ ä¸ªå¯¹è±¡ä¸­è¿›è¡Œä¿®æ”¹ï¼Œä½†æ˜¯å†åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ä¹Ÿä¸åˆé€‚ï¼Œæ‰€ä»¥å°±æ˜¯ç”¨è£…é¥°å™¨ï¼Œå¯¹å…¶ä¸­ä¸€éƒ¨åˆ†å¯¹è±¡è¿›è¡Œä¿®é¥°ï¼ˆå°å¹…åº¦çš„æ”¹åŠ¨ï¼‰ã€‚

**ç±»çš„ä¿®é¥°å™¨**

```js
function language(value){
  return function(target){
    target.language = value
  }
}
@language('English')
class Country{}
Country.language // English
```

**å®ä¾‹æ–¹æ³•ä¿®é¥°å™¨**

ä¿®é¥°å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°

- target ç±»çš„ prototype
- name ä¿®é¥°çš„æ–¹æ³•åç§°
- escriptor è¯¥æ–¹æ³•çš„ä¿®é¥°å™¨

```js
// ä¿®é¥°å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°


```

> JSçš„ä¿®é¥°å™¨ä¸»è¦ä¾èµ–äº `Object.defineProperty` åŠŸèƒ½ï¼Œå½“è§£é‡Šå™¨é‡åˆ°äº† `@decorator` çš„è¯­æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªä¿®é¥°å™¨å‡½æ•°å¯¹å±æ€§ï¼ˆæ–¹æ³•ï¼‰çš„æè¿°ç¬¦ï¼ˆdescriptorï¼‰è¿›è¡Œæ“ä½œï¼Œç„¶åå°†ä¿®é¥°è¿‡çš„ `descriptor` é‡æ–°å®šä¹‰å±æ€§



## ES5 é¢å‘å¯¹è±¡

> class æ˜¯ ES6 çš„è¯­æ³•ç³–ï¼Œå¯ä»¥ç›´æ¥å£°æ˜ç±»ï¼Œåœ¨æ²¡æœ‰è¯­æ³•ç³–ä¹‹å‰å¦‚ä½•å®ç°å‘¢ï¼Ÿ

**å¯¹è±¡çš„å°è£…æ–¹å¼**

æ™®é€šå°è£…ï¼ˆè°ƒç”¨æ–¹æ³•è¿”å›å¯¹è±¡ï¼‰

```js
function creatPhone(name,prise){
  var obj = new Object();
  obj.name = name;
  obj.prise = prise;
  console.log(obj.name);
  console.log(obj.prise);
  return obj;
} 
var xiaomi = creatPhone("å°ç±³","996");
var zhongxing = creatPhone("åä¸º","007");
```

new å°è£…ï¼ˆé€šè¿‡æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼‰

> **æ„é€ å‡½æ•°**ï¼ˆä½¿ç”¨ `new` å…³é”®å­—åˆ›å»ºçš„å¯¹è±¡ï¼‰æ„é€ å‡½æ•°ä¸€èˆ¬é¦–å­—æ¯å¤§å†™

```js
function Phone(name,prise){
  this.name = name;
  this.prise = prise;
  this.showname=function(){
    alert(obj.name);
  };
  alert(this.prise);
} 
var xiaomi = new Phone("å°ç±³","996");
xiaomi.showname()
```

**ä¸¤è€…åŒºåˆ«**

- æ™®é€šå°è£…

  ï¼ˆæ–¹æ³•ï¼‰æ²¡åŠæ³•ç»§æ‰¿ï¼Œåªæ˜¯é€šè¿‡æ–¹æ³•åˆ›å»ºäº†ä¸ªç‹¬ç«‹å¯¹è±¡

  æ‰§è¡Œæ–¹æ³•ï¼Œè¿”å›å€¼æ˜¯åˆ›å»ºå¥½çš„å¯¹è±¡

- new å°è£…

  å½“å‰å‡½æ•°ä¸­çš„ this æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡

  è‡ªåŠ¨è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯ä»¥å°è£…å‡½æ•°å¯ä»¥ç»§æ‰¿

### åŸå‹å¯¹è±¡

åŸå‹é€šå¸¸æŒ‡çš„æ˜¯ `prototype` å’Œ `__proto__` è¿™ä¸¤ä¸ªåŸå‹å¯¹è±¡ã€‚

`prototype`ï¼ˆæ˜¾å¼åŸå‹å¯¹è±¡ï¼‰ï¼š`prototype` ä¸Šçš„å†…å®¹ä¼šåœ¨ `new` çš„æ—¶å€™ï¼Œä½œä¸ºæ–°å¯¹è±¡çš„å±æ€§ä¿ç•™ä¸‹æ¥ã€‚

```js
// æ„é€ å‡½æ•°
function Phone(name, prise) {
  this.name = name;
  this.prise = prise;
};
// æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡
Phone.prototype.showName = function () {
  alert("é€‰æ‹©ç”Ÿäº§çš„æ‰‹æœºä¸ºï¼š" + this.name);
}
Phone.prototype.showWork = function () {
  alert("å·¥ä½œæ—¶é—´ä¸º" + this.prise);
}
var xiaomi = new Phone("å°ç±³", "996");
var huawei = new Phone("åä¸º", "007");
xiaomi.showName();
huawei.showWork();
```

`__proto__`ï¼ˆéšå¼åŸå‹å¯¹è±¡ï¼‰ï¼š`__proto__` ä¸Šçš„å†…å®¹ä¼šä½œä¸ºé™æ€æ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¸Šç›´æ¥æä¾›è°ƒç”¨

ç»™æ„é€ å‡½æ•°ä¸Šæ·»åŠ åŸå‹å¯¹è±¡ prototypeï¼Œèƒ½ä¸ºåŸå‹å¯¹è±¡æ·»åŠ æ–¹æ³•ï¼Œé‚£ä¹ˆæ„é€ å‡½æ•°æ„é€ å‡ºæ¥çš„å¯¹è±¡å…±äº«åŸå‹ä¸Šæ‰€æœ‰çš„æ–¹æ³•ã€‚

`prototype` å’Œ `__proto__`

```js
// function å£°æ˜ä¸€ä¸ªç±»ï¼Œå¸¸ç”¨çš„å†…å®¹
function Puppy(age) {
  this.puppyAge = age; // this æŒ‡å‘åˆ›å»ºåçš„å¯¹è±¡ï¼Œè®¤ä¸ºåˆå§‹æ˜¯ç©ºçš„å³å¯
}
Puppy.prototype.say = function(){
  console.log('æ—ºæ—º');
}
Puppy.__proto__.say = function(){
  console.log('é˜¿å˜');
}
// å®ä¾‹åŒ–æ—¶å¯ä»¥ä¼ å¹´é¾„å‚æ•°äº†
const myPuppy = new Puppy(2);
myPuppy.puppyAge // è¯æ˜äº†æŒ‡å‘çš„æ˜¯æ„é€ åçš„å‡½æ•°
myPuppy.say() // è°ƒç”¨çš„æ˜¯ Puppy ä½¿ç”¨ prototype ç”Ÿæˆçš„
Puppy.say() // è°ƒç”¨çš„æ˜¯ Puppy ä½¿ç”¨ __proto__ ç”Ÿæˆçš„

// console.log(new Puppy()==new Puppy()) // false
Puppy.prototype.say === myDog.say // true
myPuppy.__proto__ === Puppy.prototype // true
Puppy.prototype.__proto__ === Object.prototype // true è¯´æ˜ï¼Œæ‰€æœ‰ new çš„æ„é€ æ–¹æ³• prototype éƒ½æ˜¯æŒ‚è½½åœ¨ä¸€ä¸ª new çš„ Object ä¸Šé¢ï¼Œå¦‚æœè¦å®ç°ç»§æ‰¿ï¼Œåªè¦æ›´æ”¹ Puppy.prototype.__proto__ è®©å®ƒæŒ‡å‘çˆ¶ç±»çš„ prototype å³å¯
```

`constructor`

ä¸€ä¸ªä¿ç•™å…³é”®å­—ï¼Œç”¨æ¥æŒ‡å‘ `prototype` æˆ–è€… `__proto__` é“¾æ¥çš„å¯¹è±¡

```js
function Puppy(age) {
  this.puppyAge = age; // this æŒ‡å‘åˆ›å»ºåçš„å¯¹è±¡ï¼Œè®¤ä¸ºåˆå§‹æ˜¯ç©ºçš„å³å¯
}
Puppy.prototype.say = function(){
  console.log('æ—ºæ—º');
}
Puppy.__proto__.say = function(){
  console.log('é˜¿å˜');
}
const myPuppy = new Puppy(2);
myPuppy.__proto__.constructor.__proto__.say()
myPuppy.say()
```

å¦‚æœä¿®æ”¹æ„é€ å‡½æ•°çš„ `constructor` å¹¶ä¸ä¼šä¿®æ”¹æ„é€ å‡½æ•°

> æˆ–è€…ç›´æ¥ç†è§£ï¼Œ`prototype.constructor` åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç±»ä¼¼äº this æ”¹å˜ this åªæ˜¯æ”¹å˜ this çš„æŒ‡å‘ï¼Œè€Œä¸æ˜¯ this æŒ‡å‘å†…å®¹çš„å€¼

```js
function Puppy(age) {
  this.puppyAge = age;
}
// å¦‚æœä¿®æ”¹ Puppy.prototype.constructor åªä¼šä¿®æ”¹ constructor æŒ‡é’ˆçš„æŒ‡å‘
Puppy.prototype.constructor = function myConstructor(age) {
  this.puppyAge = age + 1;
  console.log(this.puppyAge)
}
const myPuppy = new Puppy(5)

myPuppy2.constructor(999)
```

### é™æ€æ–¹æ³•çš„å®ç°

æ¯”è¾ƒç›´æ¥çš„å®ç°

```js
function Puppy(age){
  this.puppyAge = age
}
// name ä¸ºä¿ç•™å­—ï¼Œä¸èƒ½è®¾ç½® Puppy.name
Puppy.cuier = 'é«˜'
console.log(Puppy.cuier)
```

åœ¨ `Puppy.__proto__` ä¸­ä¿®æ”¹ï¼Œä¼šè¿å¸¦ä¿®æ”¹ Puppy ä¸Šçš„å†…å®¹

```js
function Puppy(age) {
  this.puppyAge = age
}
Puppy.cuier = 'ä¸´é«˜'
Puppy.__proto__.cuier = 'å¯æ˜'
console.log(Puppy.cuier)
console.log(Puppy.__proto__.cuier)
console.log(Puppy.__proto__.cuier === Puppy.cuier)

Puppy.__proto__.fake = 'è™šå‡'
console.log(Puppy.fake)
console.log(Puppy.__proto__.fake)
console.log(Puppy.__proto__.fake === Puppy.fake)

Puppy.truth = 'çœŸå®'
console.log(Puppy.truth)
console.log(Puppy.__proto__.truth)
```

### ç»§æ‰¿çš„å®ç°

ç»§æ‰¿ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œä¼šè®©å­ç±»æ‹¥æœ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ä¸Šé¢çš„å†…å®¹ã€‚

å­ç±»ä¸Šå¯ä»¥æ·»åŠ å†…å®¹ï¼Œæˆ–è€…æ˜¯è¦†ç›–çˆ¶ç±»ä¸Šé¢çš„å†…å®¹



å¦‚ä½•å®ç°ç»§æ‰¿ï¼Œè¦åŒæ—¶å®ç°åŸå‹çš„ç»§æ‰¿å’Œé™æ€æ–¹æ³•çš„ç»§æ‰¿ã€‚

åŸå‹çš„ç»§æ‰¿ï¼Œè®© `__proto__` æŒ‡å‘çˆ¶ç±»åŸå‹çš„ `prototype` å°±å¯ä»¥äº†

```js
function Parent() {}
function Child() {}

Child.prototype.__proto__ = Parent.prototype
```

ä½†æ˜¯è¿™æ ·åšï¼Œåªæ˜¯è®© `Child` èƒ½å¤Ÿè®¿é—®åˆ° `Parent` çš„  `prototype`

æ‰€ä»¥ï¼Œå¿…é¡»ä½¿ç”¨

```js
function Parent() {
  this.parentAge = 50
}
function Child() {}

// Child.prototype.__proto__ = Parent.prototype;// å¦‚æœé€šè¿‡è¯¥æ–¹æ³•è¿›è¡Œç»§æ‰¿ï¼Œåªèƒ½è®© Child è®¿é—®ï¼ŒChild çš„å­å¯¹è±¡æ— æ³•è®¿é—®
Child.prototype.__proto__ = new Parent() // é€šè¿‡è®© Child çš„åŸå‹æŒ‡å‘ Parent æ¥å®ç°ç»§æ‰¿

const obj = new Child()
console.log(obj.parentAge)
```

æˆ–è€…ä½¿ç”¨

```js
function Parent() {
  this.parentAge = 50
}
function Child() {}

Child.prototype = new Parent()
Child.prototype.constructor = Child
// å¦‚æœ Child.prototype æŒ‡å‘äº† Parentï¼ŒChild.prototype.constrcutor ä¹Ÿä¼šè·Ÿç€æŒ‡å‘ Parentï¼Œè€Œä¸æ˜¯ Child

const obj = new Child()
console.log(Parent.prototype.constructor)
```

é™æ€æ–¹æ³•çš„ç»§æ‰¿

> å¦‚æœå°†çˆ¶å¯¹è±¡çš„åŸå‹å¯¹è±¡èµ‹å€¼ç»™å­å¯¹è±¡ï¼Œä¼šå¯¼è‡´ä¸¤ä¸ªå¯¹è±¡å…¬ç”¨åŒä¸€ä¸ªåŸå‹å¯¹è±¡
>
> è§£å†³åŠæ³•ï¼Œç”¨ for in å¾ªç¯è¿›è¡ŒåŸå‹å¯¹è±¡çš„èµ‹å€¼

```js
function Dog({name,sex,master}){
  this.name = name;
  this.sex=sex;
  this.master =master;
}
Dog.prototype.file = function(){
  alert(`è¿™åªç‹—æ˜¯${this.master}å…ˆç”Ÿå®¶çš„ä¸€æ¡ç‹—ï¼Œæ˜¯ä¸€æ¡${this.sex}${this.name}`);
};
function TinyDog({name,sex,master,weight}){
  Dog.call(this,{
    name:name,
    sex:sex,
    master:master
  });
  this.weight = weight;
};
// ä½¿ç”¨forå¾ªç¯è¿›è¡Œç»§æ‰¿
for(var attr in Dog.prototype){
  TinyDog.prototype[attr] = Dog.prototype[attr];
}
var bomei = new TinyDog({
  name:"åšç¾çŠ¬",
  sex:"male",
  master:"è€åˆ˜",
  weight:0.78
});
bomei.file();
var alasika = new TinyDog({
  name:"é˜¿æ‹‰æ–¯åŠ ",
  sex:"female",
  master:"è€èµµ",
  weight:1.8
})
// ç”¨æ„é€ å‡½æ•°æ„é€ çš„å¯¹è±¡ï¼Œæœ‰ä¸€ä¸ª__proto__,æŒ‡å‘æ„é€ å‡ºè¿™ä¸ªå¯¹è±¡çš„æ„é€ å‡½æ•°åŸå‹
alert(bomei.__proto__==Dog.prototype);
// instanceof ç”¨äºåˆ¤æ–­æŸä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯è¿™ä¸ªæ„é€ å‡½æ•°æ„é€ çš„ 
alert(bomei instanceof Dog);
```

> - ç»§æ‰¿ä¾§é‡çš„æ˜¯çˆ¶ä¸€çº§ç»§æ‰¿çš„æ„é€ å‡½æ•°å’Œæ–¹æ³•
> - å¤šæ€ä¾§é‡çš„æ˜¯å­ä¸€çº§å¯ä»¥é‡å†™æ„é€ å‡½æ•°å’Œæ–¹æ³•

å…¶å®ƒç»§æ‰¿æ–¹å¼

é€šè¿‡ `for...in` å¾ªç¯éå†ç»§æ‰¿

```js
for(var funcName in person.prototype){
  Worker.prototype[funcName] = Person.prototype[funcName];
}
```

`Object.create()`

```js
Worker.prototype = Object.create(Person.prototype);
// ä½¿ç”¨ Worker ç»§æ‰¿ Person
```

è°ƒç”¨å‡½æ•°æ„é€ ç»§æ‰¿

```js
Worker.prototype.__proto__ = new Person();
```

### æ€»ç»“

â€‹	![img](https://uploadfiles.nowcoder.com/images/20220301/4107856_1646121650388/2B869BED138922220E1DC0C5C1B898EE)

`prototype` æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥ä»–ä¹Ÿæœ‰ `__proto__`ï¼ŒæŒ‡å‘äº†ä»–çˆ¶çº§çš„ `prototype`ã€‚`__proto__` å’Œ `prototype` çš„è¿™ç§é“¾å¼æŒ‡å‘æ„æˆäº† JS çš„åŸå‹é“¾ã€‚åŸå‹é“¾çš„æœ€ç»ˆæŒ‡å‘æ˜¯`Object`çš„åŸå‹ã€‚`Object`ä¸Šé¢åŸå‹é“¾æ˜¯`null`ï¼Œå³`Object.prototype.__proto__ === null`ã€‚

`prototype.constructor`æŒ‡å‘çš„æ˜¯æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ç±»å‡½æ•°æœ¬èº«ã€‚æ”¹å˜è¿™ä¸ªæŒ‡é’ˆå¹¶ä¸èƒ½æ”¹å˜æ„é€ å‡½æ•°ã€‚

ä¸ºäº†è®©å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡èƒ½å¤Ÿè®¿é—®åˆ°`prototype`ä¸Šçš„å±æ€§å’Œæ–¹æ³•ï¼Œå®ä¾‹å¯¹è±¡çš„`__proto__`æŒ‡å‘äº†ç±»çš„`prototype`ã€‚æ‰€ä»¥`prototype`æ˜¯å‡½æ•°çš„å±æ€§ï¼Œä¸æ˜¯å¯¹è±¡çš„ã€‚å¯¹è±¡æ‹¥æœ‰çš„æ˜¯`__proto__`ï¼Œæ˜¯ç”¨æ¥æŸ¥æ‰¾`prototype`çš„ã€‚

## å‚è€ƒæ–‡ç« 

| ä½œè€…          | æ–‡ç« åç§°                                                     |
| ------------- | ------------------------------------------------------------ |
| è’‹é¹é£        | [è½»æ¾ç†è§£JSä¸­çš„é¢å‘å¯¹è±¡ï¼Œé¡ºä¾¿ææ‡‚`prototype`å’Œ`__proto__`](https://juejin.cn/post/6844904069887164423) |
| babelå®˜æ–¹æ–‡æ¡£ | https://babeljs.io/docs/en/babel-plugin-proposal-numeric-separator |
| å››æœˆç™½ç»µç¾Š    | https://www.jianshu.com/p/43d88a4180f8                       |
| nu11          | https://juejin.cn/post/6844904100144889864                   |
| Hemanth HM    | [ES2022 Features!](https://h3manth.com/ES2022/)              |
|               |                                                              |

### ç›¸å…³æ–‡ç« 

| çŸ¥è¯†ç‚¹ | é“¾æ¥                                       |
| ------ | ------------------------------------------ |
| è£…é¥°å™¨ | https://www.jianshu.com/p/afef44d449bd     |
| è£…é¥°å™¨ | https://juejin.cn/post/6844903876605280269 |
| è£…é¥°å™¨ | https://juejin.cn/post/6844904100144889864 |
| è£…é¥°å™¨ | https://juejin.cn/post/6999451760934780941 |

