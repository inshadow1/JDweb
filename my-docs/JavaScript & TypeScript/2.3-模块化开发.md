---
sidebar_position: 35
---

> Create by **fall** on 11 Oct 2020
> Recently revised in 21 Dec 2023 

## æ¨¡å—åŒ–å¼€å‘

å•ä¸€æ–‡ä»¶å¼€å‘ï¼ˆæ‰€æœ‰è„šæœ¬æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶å†…ï¼‰ç¼ºç‚¹å¾ˆå¤šï¼šå‡½æ•°å‘½åå†²çªã€ç»´æŠ¤èµ·æ¥ç‰¹åˆ«ç¹çã€ä¸Šä¸‹æ–‡æŸ¥æ‰¾å›°éš¾ã€‚

æ‰€è°“çš„æ¨¡å—åŒ–å¼€å‘å°±æ˜¯å°†å·¨å¤§çš„å¤§ä¸€æ–‡ä»¶ï¼Œè¿›è¡Œæ¨¡å—åŒ–çš„æ‹†åˆ†ï¼Œé€šè¿‡æ‹†åˆ†æ¥å‡å°‘å•ä¸ªæ–‡ä»¶å¸¦æ¥çš„ç¼ºç‚¹ï¼Œä½¿ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ã€‚

åˆ†å‰²æ–‡ä»¶ï¼šé€šè¿‡å•ç‹¬åœ°å°†ä¸€ä¸ªåŠŸèƒ½å°è£…åˆ°æ¨¡å—ï¼ˆæ–‡ä»¶ï¼‰ä¸­ï¼Œæ¨¡å—ä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œé€šè¿‡ç‰¹å®šçš„æ¥å£å…¬å¼€å†…éƒ¨æˆå‘˜ï¼Œæˆ–è€…å¼•å…¥åˆ«çš„æ¨¡å—ã€‚è¿™æ ·å¼€å‘å¯ä»¥æ–¹ä¾¿ä»£ç é‡ç”¨ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼Œå¹¶ä¸”æ–¹ä¾¿åæœŸç»´æŠ¤ã€‚

> è§„èŒƒç§ç±»ï¼š
>
> ECMA æå‡ºçš„å®˜æ–¹è§„èŒƒï¼šESM
>
> åœ¨å®˜æ–¹è§„èŒƒæå‡ºä¹‹å‰ï¼Œç¤¾åŒºæ›¾æå‡ºè¿‡è‡ªå·±çš„å®ç°è§„èŒƒï¼Œå¹¶ä¸æ˜¯é€šç”¨çš„æ¨¡å—åŒ–è§„èŒƒï¼Œè¿™äº›è§„èŒƒæœ‰ï¼š
>
> - åº”ç”¨äºæœåŠ¡å™¨çš„è§„èŒƒï¼šCommonJS è§„èŒƒ
> - åº”ç”¨äºæµè§ˆå™¨ç«¯çš„è§„èŒƒï¼šAMD è§„èŒƒï¼ŒCMD è§„èŒƒ
> - é€šç”¨çš„è§„èŒƒï¼šUMD è§„èŒƒ

### åŠ è½½æ¨¡å¼

æµè§ˆå™¨ä¼ ç»ŸåŠ è½½æ¨¡å¼

```html
<!-- åŒæ­¥åŠ è½½ -->
<script src="test.js"></script>
<!-- åŒæ­¥åŠ è½½ï¼Œé¡ºåºæ‰§è¡Œï¼Œæ–‡æ¡£è§£æå®Œæˆåæ‰§è¡Œ -->
<script src="test.js" defer></script>
<!-- å¼‚æ­¥åŠ è½½ï¼Œåªè¦ä¸‹è½½å®Œå°±æ‰§è¡Œ--> 
<script src="test.js" async></script>
```

æµè§ˆå™¨ `<script>` æ ‡ç­¾ä¸­è®¾ç½® `type = "module"` å°†é»˜è®¤æŒ‰ç…§ defer è¿›è¡ŒåŠ è½½

```html
<!-- ES6 çš„æ¨¡å—ä¾èµ–äº import export ä¸¤ä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”è‡ªåŠ¨é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ -->
<script type="module" src="test.js"></script>
```

**åŒæ­¥åŠ è½½**

`<script src="script.js"></script>`

æ²¡æœ‰ defer æˆ– asyncï¼Œæµè§ˆå™¨ä¼šç«‹å³åŠ è½½å¹¶æ‰§è¡ŒæŒ‡å®šçš„è„šæœ¬ï¼Œè¯»åˆ°è„šæœ¬å°±åŠ è½½å¹¶æ‰§è¡Œï¼ˆä¸­æ–­æµè§ˆå™¨æ¸²æŸ“ï¼‰ã€‚

**å¼‚æ­¥åŠ è½½**ï¼š

`<script async src="script.js"></script>`

`async` è¡¨ç¤ºå¼‚æ­¥æ‰§è¡Œ JavaScriptï¼Œæ— è®ºæ­¤åˆ»æ˜¯ HTML è§£æé˜¶æ®µè¿˜æ˜¯ DOMContentLoaded è§¦å‘ä¹‹åï¼Œå¦‚æœå·²ç»åŠ è½½å¥½ï¼Œå°±ä¼šå¼€å§‹æ‰§è¡Œã€‚ä½†æ˜¯è¿™ç§æ–¹å¼åŠ è½½çš„ JavaScript ä¾ç„¶ä¼šé˜»å¡ load äº‹ä»¶ã€‚async-script å¯èƒ½åœ¨ DOMContentLoaded è§¦å‘ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œï¼Œä½†ä¸€å®šåœ¨ load è§¦å‘ä¹‹å‰æ‰§è¡Œã€‚

**å»¶è¿Ÿæ‰§è¡Œ**ï¼š

`<script defer src="script.js"></script>`

`defer` å±æ€§è¡¨ç¤ºå»¶è¿Ÿæ‰§è¡Œå¼•å…¥çš„ JavaScriptï¼Œå³è¿™æ®µ JavaScript åŠ è½½æ—¶ HTML å¹¶æœªåœæ­¢è§£æï¼Œè¿™ä¸¤ä¸ªè¿‡ç¨‹æ˜¯å¹¶è¡Œçš„ã€‚æ•´ä¸ª document è§£æå®Œæ¯•ä¸” defer-script ä¹ŸåŠ è½½å®Œæˆä¹‹åï¼Œä¼šæ‰§è¡Œæ‰€æœ‰ç”± defer-script åŠ è½½çš„ JavaScript ä»£ç ï¼Œç„¶åè§¦å‘ DOMContentLoaded äº‹ä»¶ã€‚

defer ä¸ç›¸æ¯”æ™®é€š scriptï¼Œæœ‰ä¸¤ç‚¹åŒºåˆ«ï¼šè½½å…¥ JavaScript æ–‡ä»¶æ—¶ä¸é˜»å¡ HTML çš„è§£æï¼Œæ‰§è¡Œé˜¶æ®µè¢«æ”¾åˆ° HTML æ ‡ç­¾è§£æå®Œæˆä¹‹åã€‚åœ¨åŠ è½½å¤šä¸ª JS è„šæœ¬çš„æ—¶å€™ï¼Œasync æ˜¯æ— é¡ºåºçš„åŠ è½½ï¼Œè€Œ defer æ˜¯æœ‰é¡ºåºçš„åŠ è½½ã€‚

## ESM è§„èŒƒ

- å¯¼å…¥çš„å˜é‡åå¿…é¡»ä¸å¯¼å‡ºæ¨¡å—çš„åå­—ä¸€è‡´ï¼Œå¯ä»¥ä½¿ç”¨ `as` è¿›è¡Œé‡å‘½åï¼›
- å¯¼å…¥çš„å˜é‡éƒ½æ˜¯åªè¯»çš„ï¼Œä¸èƒ½æ”¹å†™ï¼›
- `import` å‘½ä»¤å…·æœ‰æå‡æ•ˆæœï¼Œä¼šæå‡åˆ°æ•´ä¸ªæ¨¡å—çš„å¤´éƒ¨ï¼Œé¦–å…ˆæ‰§è¡Œï¼›
- `import` æ˜¯ç¼–è¯‘æ—¶å¯¼å…¥ï¼Œæ‰€ä»¥ä¸èƒ½å°†å…¶å†™åˆ°ä»£ç å—ï¼ˆæ¯”å¦‚ `if` åˆ¤æ–­å—é‡Œï¼‰æˆ–è€…å‡½æ•°å†…éƒ¨ï¼›
- `import` ä¼šæ‰§è¡Œæ‰€åŠ è½½çš„æ¨¡å—çš„ä»£ç ï¼Œå¦‚æœé‡å¤å¯¼å…¥åŒä¸€ä¸ªæ¨¡å—åˆ™åªä¼šæ‰§è¡Œä¸€æ¬¡æ¨¡å—ï¼›

### å¯¼å…¥å¯¼å‡º

åœ¨è§„èŒƒä¸­å®šä¹‰ï¼Œæ¯ä¸ª JS æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ã€‚

**å¯¼å…¥æ¨¡å—æˆå‘˜**ï¼Œä½¿ç”¨ import å…³é”®å­—ã€‚æš´éœ²æ¨¡å—æˆå‘˜ä½¿ç”¨ export å…³é”®å­—ã€‚

```js
// tool.js
export function workFlow() {
  console.log('å…¬å¸æ˜¯æˆ‘å®¶')
}
export const lovelyNum = '996'
// main.js
import { lovelyNum , workFlow } from './tool.js'
workFlow()
```

### å‘½åå¯¼å…¥å¯¼å‡º

è¿›è¡Œå‘½åå¯¼å…¥å¯¼å‡º

```js
// tool.js
function workFlow () {
  console.log('å…¬å¸æ˜¯æˆ‘å®¶')
}
const lovelyNum = '996'
export {workFlow,favorite as lovelyNum} // å°† lovelyNum å‘½åä¸º favorite è¿›è¡Œå¯¼å‡º
// main.js
import {lovelyNum as luckyNum} from './tool.js'
console.log(luckyNum) // '996'
```

### å‘½åç©ºé—´å¯¼å…¥

å‘½åå¯¼å…¥å¯¼å‡ºæœ‰æ—¶è¿‡äºç¹çï¼Œæ­¤æ—¶ä¼šä½¿ç”¨**å‘½åç©ºé—´å¯¼å…¥**

```js
// tool.js
export export function createID () {
  const date = new Date()
  return date.getTime
}
export lovelyNum = '996'
// main.js
import * as creature from './tool.js'
creature.lovelyNum // 996
```

### é»˜è®¤å¯¼å…¥ç»„ä»¶

**é»˜è®¤å¯¼å…¥ç»„ä»¶**

`export default` æ˜¯é»˜è®¤å¯¼å‡ºçš„å†…å®¹ï¼Œä½¿ç”¨æ—¶ï¼Œç›´æ¥å¯¼å…¥å³å¯ã€‚

```js
// moudle.js
let cagg = 233
function app(){console.log(app)}
export default {
  cagg,app
}
// index.js
import app from './moudle.js'
app.cagg
```

### å¯¼å…¥åç›´æ¥æ‰§è¡Œ

**å¼•å…¥ç›´æ¥æ‰§è¡Œçš„æ–‡ä»¶**

ä½¿ç”¨è¯¥æ–¹æ³•å¼•å…¥çš„æ–‡ä»¶ä¼šç›´æ¥æ‰§è¡Œ

```js
// run.js
console.log('Baidiaoo')
// index.js
import './run.js'
```

### å¼•å…¥å¤šä¸ªç»„ä»¶

**å¼•å…¥å¤šä¸ªç»„ä»¶**

```js
// moudle.js
export milk = 'ä¸€å¤©ä¸€ç“¶ï¼Œä¹Ÿå–ä¸ç©·'
let eggs = 233
function app(){console.log(app)}
export default {
   eggs,app
}
// index.js
import app,{milk} from './moudle.js'
app.eggs
console.log(milk)
```

### ç›´æ¥å¯¼å‡º

**ç›´æ¥å¯¼å‡º**

```js
// test.js
export some = 'take some, or learn some.'
// utils.js
export {fake as some} from './test.js'
// index.js
import {fake} from './util.js'

// è½¬å‘é»˜è®¤æ¥å£
// person.js
const name = 'å¸ƒå…°', age = 12
export default { name, age }
export { default } from './person.js'
// ç›¸å½“äº
import person from './person.js'
export default person
```

### åŠ¨æ€æŸ¥æ‰¾ç­–ç•¥

å½“ä½¿ç”¨æŸ¥æ‰¾ç­–ç•¥

```js
// æ¯”å¦‚è¯´ä½¿ç”¨ä¸€ä¸‹æŸ¥æ‰¾æ–¹æ¡ˆ
import * as foo from 'foo'
// ç³»ç»Ÿä¼šä¾æ¬¡æŒ‰ç…§ä¸‹é¢çš„ç›®å½•æŸ¥æ‰¾
// ./node_modules/foo
// .././node_modules/foo
// ../.././node_modules/foo
// ä¼šå‘ä¸Šå±‚æ–‡ä»¶å¤¹çš„ node_modulesï¼Œå†åˆ°ä¸Šå±‚ï¼Œç›´åˆ°ç³»ç»Ÿçš„æ ¹ç›®å½•

// å†æ·±ä¸€å±‚çš„å¼•å…¥ç›®å½•ä¹Ÿç›¸åŒ
// import * as foo from 'something/foo'
// ./node_modules/something/foo
// ../node_modules/something/foo
// ../../node_modules/something/foo
```

å½“å¼•å…¥ `import * as foo from 'filePath'` è¿™ä¸ª foo å…·ä½“ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿ

ä¼šä¾æ¬¡æŒ‰ç…§è¿™äº›æƒ…å†µå»åˆ†æ `filePath` 

- å®ƒæ˜¯ä¸€ä¸ªæ–‡ä»¶
- å¦åˆ™çš„è¯ï¼Œæ˜¯æ–‡ä»¶å¤¹ï¼Œä¸”æ–‡ä»¶å¤¹å­˜åœ¨ `index` æ–‡ä»¶
- å¦åˆ™çš„è¯ï¼Œæ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å­˜åœ¨ `package.json` ï¼Œè¯¥æ–‡ä»¶ä¸­æŒ‡å®šçš„ `type` æ–‡ä»¶å­˜åœ¨
- å¦åˆ™çš„è¯ï¼Œæ˜¯æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å­˜åœ¨ `package.json` ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æŒ‡å®šçš„ `main` 

è¿™äº›æ–‡ä»¶çš„ç±»å‹å¯èƒ½æ˜¯ï¼š`.ts`ã€`.d.ts`ã€`.js`

### meta

åœ¨ä½¿ç”¨ module å¼•å…¥çš„åŒ…ä½¿ç”¨ï¼ŒåŒ…å«è¿™ä¸ªæ¨¡å—çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚

```js
console.log(import.meta)
// {url:'http://127.0.0.1:3002/src/main.ts'}
```

url ä¹Ÿå¯èƒ½åŒ…å«å‚æ•°æˆ–è€…å“ˆå¸Œï¼ˆæ¯”å¦‚åç¼€ `?` æˆ– `#`ï¼‰

```html
<script type="module">
import './index.mjs?someURLInfo=5';
</script>
```

```js
new URL(import.meta.url).searchParams.get('someURLInfo')// 5
```

### åŠ¨æ€å¯¼å…¥

`import()` ä¸€ä¸ª promiseï¼Œä½†æ˜¯ `import` æœ¬èº«æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ–¹æ³•ã€‚

`import` declaration syntax (`import something from "somewhere"`) is static and will always result in the imported module being evaluated at load time. 

```js
// åªå¼•å…¥è¿™ä¸ªåŒ…çš„å‰¯ä½œç”¨
(async () => {
  if (somethingIsTrue) {
    // import module for side effects
    await import("/modules/my-module.js");
  }
})();
// å¼•å…¥åŒ…çš„é»˜è®¤åç§°
(async () => {
  if (somethingIsTrue) {
    const {
      default: myDefault,
      foo,
      bar,
    } = await import("/modules/my-module.js");
  }
})();
```

### é¡¶å±‚ await

```
const i18n = await import(`./content-${language}.mjs`);
```

```js
// index.mjs
// to top-level await
await Promise.resolve('ğŸ') // 'ğŸ'
```

## CommonJS è§„èŒƒ

> Node.js æ‰€ä½¿ç”¨çš„è§„èŒƒï¼Œç®€ç§° CJSï¼Œå¦‚æœä¸æƒ³æ·±å…¥ç†è§£ï¼Œå…¶å®ä¹Ÿå¯ä»¥å¿½ç•¥
>
> node ç‰ˆæœ¬åœ¨ 14.10 ä»¥ä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨ package.json ä¸­æ·»åŠ  `type` å±æ€§ä¸º `module` å³å¯ä½¿ç”¨ `import` ä½œä¸ºå…³é”®å­—è¿›è¡Œå¼•å…¥çš„å®ç°ã€‚

æ¯ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œå˜é‡ï¼Œä»¥åŠæ–¹æ³•ç­‰ï¼Œå¯¹å…¶ä»–çš„æ¨¡å—éƒ½ä¸å¯è§ã€‚æ¯ä¸ªæ¨¡å—å†…éƒ¨ï¼Œ`module` å˜é‡ä»£è¡¨å½“å‰æ¨¡å—ã€‚è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„ `exports` å±æ€§ï¼ˆå³`module.exports`ï¼‰æ˜¯å¯¹å¤–çš„æ¥å£ã€‚

`require()` æ–¹æ³•ç”¨äºåŠ è½½æ¨¡å—ï¼ŒåŠ è½½æ¨¡å—æ—¶ï¼Œå®é™…ä¸ŠåŠ è½½çš„æ˜¯ `module.exports` å±æ€§ã€‚

æ¨¡å—åˆ†ä¸ºä¸¤ç§ï¼Œä¸€æ˜¯ Node æä¾›çš„æ¨¡å—ï¼Œç§°ä¸ºæ ¸å¿ƒæ¨¡å—ï¼›äºŒæ˜¯ç”¨æˆ·ç¼–å†™çš„æ¨¡å—ï¼Œæˆä¸ºæ–‡ä»¶æ¨¡å—ã€‚æ ¸å¿ƒæ¨¡å—ï¼ˆHTTP æ¨¡å—ã€URL æ¨¡å—ã€FS æ¨¡å—ï¼‰åœ¨ Node æºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘è¿›äº†äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒçš„åŠ è½½é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚æ–‡ä»¶æ¨¡å—æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½çš„ï¼Œéœ€è¦å®Œæ•´çš„è·¯å¾„åˆ†æã€æ–‡ä»¶å®šä½ã€ç¼–è¯‘æ‰§è¡Œè¿‡ç¨‹ç­‰â€¦â€¦æ‰€ä»¥å®ƒçš„é€Ÿåº¦ç›¸å¯¹æ ¸å¿ƒæ¨¡å—æ¥è¯´ä¼šæ›´æ…¢ä¸€äº›ã€‚

### ä¸ ESM çš„ä¸åŒ

`ESM` çš„æ‰§è¡Œå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š

- æ„å»º: ç¡®å®šä»å“ªé‡Œä¸‹è½½è¯¥æ¨¡å—æ–‡ä»¶ã€ä¸‹è½½å¹¶å°†æ‰€æœ‰çš„æ–‡ä»¶è§£æä¸ºæ¨¡å—è®°å½•
- å®ä¾‹åŒ–: å°†æ¨¡å—è®°å½•è½¬æ¢ä¸ºä¸€ä¸ªæ¨¡å—å®ä¾‹ï¼Œä¸ºæ‰€æœ‰çš„æ¨¡å—åˆ†é…å†…å­˜ç©ºé—´ï¼Œä¾ç…§å¯¼å‡ºã€å¯¼å…¥è¯­å¥æŠŠæ¨¡å—æŒ‡å‘å¯¹åº”çš„å†…å­˜åœ°å€ã€‚

- è¿è¡Œï¼šè¿è¡Œä»£ç ï¼Œå°†å†…å­˜ç©ºé—´å¡«å……

ä»ä¸Šé¢å®ä¾‹åŒ–çš„è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œ`ESM` ä½¿ç”¨å®æ—¶ç»‘å®šçš„æ¨¡å¼ï¼Œå¯¼å‡ºå’Œå¯¼å…¥çš„æ¨¡å—éƒ½æŒ‡å‘ç›¸åŒçš„å†…å­˜åœ°å€ï¼Œä¹Ÿå°±æ˜¯å€¼å¼•ç”¨ã€‚è€Œ `CJS` é‡‡ç”¨çš„æ˜¯å€¼æ‹·è´ï¼Œå³æ‰€æœ‰å¯¼å‡ºå€¼éƒ½æ˜¯æ‹·è´å€¼ã€‚

`import` åœ¨é¡¶å±‚ä½¿ç”¨ï¼Œ`require`ï¼Œå¯ä»¥åœ¨ä»£ç ä»»æ„ä½ç½®è°ƒç”¨ï¼Œå¹¶ä¸” CJS å¯¹äº tree shaking ä¸æ˜¯å¾ˆå‹å¥½

### ä½¿ç”¨

node æä¾›ä¸¤ä¸ªå¯¹è±¡ï¼Œ exports å’Œ require ä¸¤ä¸ªå¯¹è±¡

**é»˜è®¤å¯¼å‡º**

```js
// test.js æ–‡ä»¶ï¼Œç”¨ä½œå‘å¤–æš´éœ²æ¥å£
module.exports = function(){
  console.log("è¿™å°±æ˜¯è°ƒç”¨çš„ä¸œè¥¿")
}
// å…¶ä»–æ–‡ä»¶ä½¿ç”¨ test.js
var ss = require("./test")
ss()
```

**æ™®é€šå¯¼å‡º**

```js
// test.js
exports.world = function(){
  console.log('hello')
}
// å…¶ä»–æ–‡ä»¶è¿›è¡Œä½¿ç”¨æ—¶
const hello = require('./test.js')
hello.world()
```

require çš„æŸ¥æ‰¾é¡ºåº

- é¦–å…ˆåœ¨æ–‡ä»¶æ¨¡å—ç¼“å­˜åŒº
- æ˜¯å¦æ˜¯åŸç”Ÿæ¨¡å—ï¼Œå¦‚æœæ˜¯ï¼Œå¹¶ä¸”åœ¨æ–‡ä»¶ç¼“å­˜åŒºï¼Œç›´æ¥åŠ è½½ï¼Œä¸åœ¨ç¼“å­˜åŒºè¿›è¡ŒåŠ è½½åŸç”Ÿæ¨¡å—ï¼Œç„¶åæ”¾å…¥ç¼“å­˜åŒºã€‚
- æŸ¥æ‰¾æ–‡ä»¶æ¨¡å—ï¼Œæ ¹æ®æ‰©å±•åè½½å…¥ï¼Œå¹¶ä¸”è¿›è¡Œç¼“å­˜

- å½“å‰ node.js ä»ç„¶ä½¿ç”¨çš„æ˜¯ CommonJS è§„èŒƒï¼Œæ‰€ä»¥ï¼Œä¸æ”¯æŒ `import` å¯¼å…¥å…¶ä»–çš„åŒ…ã€‚
- æ‰€æœ‰ä»£ç éƒ½è¿è¡Œåœ¨æ¨¡å—ä½œç”¨åŸŸï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸã€‚
- æ¨¡å—å¯ä»¥è¢«å¤šæ¬¡åŠ è½½ï¼Œä½†åªä¼šè¿è¡Œä¸€æ¬¡ï¼Œç„¶åå°†ç»“æœè¿›è¡Œç¼“å­˜ï¼Œä¹‹åè°ƒç”¨ä¼šç›´æ¥è°ƒç”¨ç¼“å­˜çš„ç»“æœï¼Œå¦‚æœä¸æƒ³å†è°ƒç”¨ï¼Œå¿…é¡»æ¸…é™¤ç¼“å­˜
- æ¨¡å—çš„åŠ è½½é¡ºåºå’Œä»£ç é¡ºåºç›¸åŒã€‚
- CommonJS è§„èŒƒæ˜¯æœåŠ¡å™¨è§„èŒƒï¼Œä¸€èˆ¬å…ˆä¸‹è½½åˆ°æœ¬åœ°å†è°ƒç”¨ã€‚
- è¯»å–é€Ÿåº¦éå¸¸ï¼Œå¿«é‡‡ç”¨åŒæ­¥çš„æ‰§è¡Œæ–¹å¼ã€‚

> æµè§ˆå™¨ä¸ºä½•ä¸èƒ½å…¼å®¹ CommonJS
>
> ç¼ºå°‘å››ä¸ªç¯å¢ƒå˜é‡ï¼šmodule/exports/require/global

### è§„èŒƒå¯¹æ¯”

ESM æ¨¡å—å’Œ CommonJS æ¨¡å—çš„å·®å¼‚ï¼š

- `CommonJS` æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ˆä¸€æ—¦è¾“å‡ºä¸€ä¸ªå€¼ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–å°±å½±å“ä¸åˆ°è¿™ä¸ªå€¼ï¼‰ï¼Œ`ES6` æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ï¼ˆæ˜¯åŠ¨æ€å¼•ç”¨ä¸”ä¸ä¼šç¼“å­˜å€¼ï¼Œæ¨¡å—é‡Œçš„å˜é‡ç»‘å®šå…¶æ‰€åœ¨çš„æ¨¡å—ï¼Œç­‰åˆ°è„šæœ¬çœŸæ­£æ‰§è¡Œæ—¶ï¼Œå†æ ¹æ®è¿™ä¸ªåªè¯»å¼•ç”¨åˆ°è¢«åŠ è½½çš„é‚£ä¸ªæ¨¡å—é‡Œå»å–å€¼ï¼‰ï¼›
- `CommonJS` æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼Œ`ES6` æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ï¼›
- `CommonJS` æ¨¡å—çš„ `require()` æ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œ`ES6` æ¨¡å—çš„ `import` å‘½ä»¤æ˜¯å¼‚æ­¥åŠ è½½ï¼Œæœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ä¾èµ–çš„è§£æé˜¶æ®µï¼›

## å…¶ä»–è§„èŒƒ

> Node.js éƒ½å¯ä»¥ä¸çœ‹äº†ï¼Œè¿™äº›è§„èŒƒä¹Ÿæ²¡æœ‰çœ‹çš„å¿…è¦

### AMD

AMDï¼ˆAsynchronous Module Definitionï¼‰å¼‚æ­¥æ¨¡å—å®šä¹‰ï¼Œè§„èŒƒï¼š(å®¢æˆ·ç«¯ / æµè§ˆå™¨ï¼‰

```js
// å£°æ˜ï¼š
define(function(){
  return{
    outA:showA,
    outB:showB
  }
})
// å¼•å…¥ï¼šå¼‚æ­¥æ‰§è¡Œ
require("moduleA.js",function(moduleA){
  // åœ¨æ¨¡å—å¼•å…¥åæ‰§è¡Œ
  moduleA.outA()
  moduleA.outB()
})
```

- `AMD` æ˜¯å¼‚æ­¥ï¼ˆ`asynchronously`ï¼‰å¯¼å…¥æ¨¡å—çš„ï¼ˆå› æ­¤å¾—åï¼‰
- ä¸€å¼€å§‹è¢«æè®®çš„æ—¶å€™ï¼Œ`AMD` æ˜¯ä¸ºå‰ç«¯è€Œåšçš„ï¼ˆè€Œ `CJS` æ˜¯åç«¯ï¼‰
- `AMD` çš„è¯­æ³•ä¸å¦‚ `CJS` ç›´è§‚ã€‚æˆ‘è®¤ä¸º `AMD` å’Œ `CJS` å®Œå…¨ç›¸å

> **CMD è§„èŒƒ**ï¼šé˜¿é‡Œçš„ä¸€åå‘˜å·¥ç¼–å†™çš„è§„èŒƒï¼Œå·²ç»ä¸ä½¿ç”¨äº†

**è§„èŒƒå¯¹æ¯”**

| è§„èŒƒ     | ç›¸åŒç‚¹         | ä¸åŒç‚¹                                       |
| -------- | -------------- | -------------------------------------------- |
| AMDè§„èŒƒ  | éƒ½æ˜¯ä¸ºäº†æ¨¡å—åŒ– | éåŒæ­¥åŠ è½½æ¨¡å—ï¼Œå…è®¸æŒ‡å®šå›è°ƒå‡½æ•°ï¼Œä¸ºå‰ç«¯è€Œåš |
| CommonJS |                | åŒæ­¥åŠ è½½ï¼Œåªæœ‰åŠ è½½å®Œæˆæ‰èƒ½å®Œæˆåé¢çš„æ“ä½œ     |

Require.js è¯­æ³•éµä» AMD è§„èŒƒ

å®ç°æ¨¡å—åŒ–å¼€å‘çš„è¯­æ³•ï¼Œè€Œæ¨¡å—åŒ–å¼€å‘é€æ¸æ·˜æ±°äº† Require.jsï¼ŒRequire.js åœ¨ MVC æ¨¡å¼å¼€å‘åˆæœŸå¼€åˆ›äº†è¾‰ç…Œã€‚

> æ³¨ï¼šæ¯ä¸€ä¸ª .html éƒ½è¦ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼šç®¡ç†å½“å‰ .html é¡µé¢ä½¿ç”¨çš„æ‰€æœ‰ .js ä»£ç 
> æ³¨ï¼šé™¤äº† require.js çš„åç¼€åï¼Œå…¶ä»–æ–‡ä»¶çš„åç¼€åéƒ½å¯ä»¥çœç•¥

```js
// å®¢æˆ·ç«¯ .js æ–‡ä»¶éµä» AMD è§„èŒƒ
// add.js
define(function(){
  function add(x,y){
    return x+y
  }
  function show(){
    console.log('hello world')
  }
  return {
    outAdd:add,
    outShow:show
  }
})
// main.js
// å¼•å…¥çš„è·¯å¾„å¿…é¡»ä¸ºæ•°ç»„
require(["add"],function(getObj){
  var res = getObj.outAdd(1024,2048)
  console.log(res)
})
```

```js
// å®ç°è·¯å¾„çš„è‡ªåŠ¨é…ç½®
require.config({
  path:{
    // å‡è®¾æ–‡ä»¶è·¯å¾„åœ¨demoä¸‹çš„addä¸­
    thePath:'demo/add'
  }
})
require(['thePath'],function(){
  var res = addObj.outAdd(10,20)
  addObj.outShow()
})
```

**å­æ¨¡å—ä½¿ç”¨å­æ¨¡å—çš„æ–¹æ³•**

```js
// main.js
require(['path/funA','path/funB'],function(){
  var res = addObj.outAdd(10,20)
  addObj.outShow()
}])
// funA.js
define(function(){
  function addA(a,b){
    return a+b
  }
  return {
    addA:addA
  }
})
// funB.js
define(['path/funA'],function(addA){
  add(10,11)
})
```

### UMD

`UMD` ä»£è¡¨é€šç”¨æ¨¡å—å®šä¹‰ï¼ˆ`Universal Module Definition`ï¼‰ã€‚

```js
(function (root, factory) {
  if (typeof define === "function" && define.amd) {
    define(["jquery", "underscore"], factory);
  } else if (typeof exports === "object") {
    module.exports = factory(require("jquery"), require("underscore"));
  } else {
    root.Requester = factory(root.$, root._);
  }
}(this, function ($, _) {
  // this is where I defined my module implementation

  var Requester = { // ... };

    return Requester;
  }));

```

- åœ¨å‰ç«¯å’Œåç«¯éƒ½é€‚ç”¨ï¼ˆâ€œé€šç”¨â€å› æ­¤å¾—åï¼‰
- ä¸ `CJS` æˆ– `AMD` `ä¸åŒï¼ŒUMD` æ›´åƒæ˜¯ä¸€ç§é…ç½®å¤šä¸ªæ¨¡å—ç³»ç»Ÿçš„æ¨¡å¼ã€‚[è¿™é‡Œ](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumdjs%2Fumd%2F)å¯ä»¥æ‰¾åˆ°æ›´å¤šçš„æ¨¡å¼
- å½“ä½¿ç”¨ `Rollup/Webpack` ä¹‹ç±»çš„æ‰“åŒ…å™¨æ—¶ï¼Œ`UMD` é€šå¸¸ç”¨ä½œå¤‡ç”¨æ¨¡å—ï¼Œé€šå¸¸åœ¨ `ESM` ä¸èµ·ä½œç”¨çš„æƒ…å†µä¸‹ç”¨ä½œå¤‡ç”¨

## å‚è€ƒæ–‡ç« 

| ä½œè€…             | é“¾æ¥                                                         |
| ---------------- | ------------------------------------------------------------ |
| å­—èŠ‚è·³åŠ¨ADFEå›¢é˜Ÿ | [æ·±å…¥ç†è§£Viteæ ¸å¿ƒåŸç†](https://juejin.cn/post/7064853960636989454) |
| Gopal            | [ã€é¢è¯•è¯´ã€‘Javascript ä¸­çš„ CJS, AMD, UMD å’Œ ESMæ˜¯ä»€ä¹ˆï¼Ÿ](https://juejin.cn/post/6935973925004247077) |
|                  |                                                              |

